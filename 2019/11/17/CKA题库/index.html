

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;light&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="jame_xhs">
  <meta name="keywords" content="">
  <title>CKA题库 - jame_xhs&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.jxhs.me","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>jame_xhs blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/more-order/">
                <i class="iconfont icon-slack-fill"></i>
                越阶计划
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                书单
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/book-2021/">
                    
                    2021
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/book-2020/">
                    
                    2020
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="CKA题库">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2019-11-17 18:34" pubdate>
        2019年11月17日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      61
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">CKA题库</h1>
            
            <div class="markdown-body">
              <h1 id="题库一"><a href="#题库一" class="headerlink" title="题库一"></a>题库一</h1><p>24 题，160 分钟。</p>
<h2 id="第一题-5-日志"><a href="#第一题-5-日志" class="headerlink" title="第一题 (5%) 日志"></a>第一题 (5%) 日志</h2><p>监控 Pod bar 的日志，并提取与错误 file-not-found 相对应的日志行,将这些日志行写入 /opt/dir/bar</p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl logs <span class="hljs-symbol">&lt;podname&gt;</span> | <span class="hljs-keyword">grep</span> Error &gt; /<span class="hljs-keyword">opt</span>/KUCC000xxx/KUCC000xxx.txt<br></code></pre></div></td></tr></table></figure>

<p>考点：Monitor, Log, and Debug</p>
<h2 id="第二题-3-PV-按大小排序"><a href="#第二题-3-PV-按大小排序" class="headerlink" title="第二题 (3%) PV 按大小排序"></a>第二题 (3%) PV 按大小排序</h2><p>(使用 kubectl 的自带功能对输出排序，不要做其他任何处理)<br>按 capacity 排序列出所有 persistent volumes, 将完整的 kubectl 输出保存到 /opt/dir/volume_list</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> pv <span class="hljs-attribute">--sort-by</span>=<span class="hljs-string">'&#123;spec.capacity.storage&#125;'</span><br></code></pre></div></td></tr></table></figure>

<p><strong>列出环境内所有的 pv 并以 name 字段排序（使用 kubectl 自带排序功能）</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> pv <span class="hljs-attribute">--sort-by</span>=.metadata.name<br></code></pre></div></td></tr></table></figure>

<p>考点：kubectl 命令熟悉程度</p>
<h2 id="第三题-3-创建-Pod"><a href="#第三题-3-创建-Pod" class="headerlink" title="第三题 (3%) 创建 Pod"></a>第三题 (3%) 创建 Pod</h2><p>按如下要求创建一个 Pod：</p>
<p>名称：jenkins<br>使用 image: jenkins<br>在名为 website-frontend 的 新 kubernetes namespace 中</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-comment"># 方法一: 通过命令创建</span><br>kubectl <span class="hljs-builtin-name">run</span> jenkins <span class="hljs-attribute">--image</span>=jenkins <span class="hljs-attribute">--namespace</span>=website-frontend <span class="hljs-attribute">--replicas</span>=1 <span class="hljs-attribute">--generator</span>=run-pod/v1 <span class="hljs-attribute">--labels</span>=app=jenkins --dry-<span class="hljs-builtin-name">run</span> -o yaml<br><br><span class="hljs-comment"># 方法二: 编写yaml</span><br>apiVersion: v1<br>kind: Pod<br>nameSpace: website-frontend<br>metadata:<br>  name: jenkins<br>spec:<br>  containers:<br>  - name: jenkins<br>    image: jenkins<br></code></pre></div></td></tr></table></figure>

<h2 id="第四题-4-EmptyDir"><a href="#第四题-4-EmptyDir" class="headerlink" title="第四题 (4%) EmptyDir"></a>第四题 (4%) EmptyDir</h2><p>按如下要求创建一个 Pod：</p>
<p>名称：non-persistent-redis<br>Container image: redis<br>Persistent volume name: cache-control<br>Mount Path: /data/redis<br>应在 staging namespace 中发布，且该 volume 必须不能是永久的。</p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-attribute">apiVersion</span>: v1<br><span class="hljs-attribute">kind</span>: Pod<br><span class="hljs-attribute">metadata</span>:<br>  <span class="hljs-attribute">name</span>: non-persistent-redis<br>  <span class="hljs-attribute">namespace</span>: staging<br><span class="hljs-attribute">spec</span>:<br>  <span class="hljs-attribute">containers</span>:<br>  - <span class="hljs-attribute">name</span>: non-persistent-redis<br>    <span class="hljs-attribute">image</span>: redis<br>    <span class="hljs-attribute">volumeMounts</span>:<br>      - <span class="hljs-attribute">name</span>: cache-control<br>        <span class="hljs-attribute">mountPath</span>: /data/redis<br>  <span class="hljs-attribute">volumes</span>:<br>  - <span class="hljs-attribute">name</span>: cache-control<br>    <span class="hljs-attribute">emptyDir</span>: &#123;&#125;<br></code></pre></div></td></tr></table></figure>

<p>考点：Volume、emptdir</p>
<p>参考：<a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir" target="_blank" rel="noopener">Volumes</a></p>
<h2 id="第五题-3-DaemonSet"><a href="#第五题-3-DaemonSet" class="headerlink" title="第五题 (3%) DaemonSet"></a>第五题 (3%) DaemonSet</h2><p>确保在 Kubernetes cluster 的每个 node 上都运行 pod nginx 的一个实例，此处，nginx 也表示必须使用的 image 名称。切勿覆盖当前存在的任何 taint。</p>
<p>使用 DaemonSet 完成此任务，并使用 ds-kubesc12345 作为 DaemonSet 名称。</p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-attribute">apiVersion</span>: apps/v1<br><span class="hljs-attribute">kind</span>: DaemonSet<br><span class="hljs-attribute">metadata</span>:<br>  <span class="hljs-attribute">name</span>: ds-kubesc12345<br>  <span class="hljs-attribute">annotations</span>:<br>    <span class="hljs-attribute">wocao</span>: wuqing<br>  <span class="hljs-attribute">labels</span>:<br>    <span class="hljs-attribute">app</span>: ds-kubesc12345<br><span class="hljs-attribute">spec</span>:<br>  <span class="hljs-attribute">selector</span>:<br>    <span class="hljs-attribute">matchLabels</span>:<br>      <span class="hljs-attribute">name</span>: ds-kubesc12345<br>  <span class="hljs-attribute">template</span>:<br>    <span class="hljs-attribute">metadata</span>:<br>      <span class="hljs-attribute">labels</span>:<br>        <span class="hljs-attribute">name</span>: ds-kubesc12345<br>    <span class="hljs-attribute">spec</span>:<br>      <span class="hljs-attribute">containers</span>:<br>      - <span class="hljs-attribute">name</span>: ds-kubesc12345<br>        <span class="hljs-attribute">image</span>: busybox<br>        <span class="hljs-attribute">command</span>:<br>        - sh<br>      <span class="hljs-attribute">tolerations</span>:<br>      - <span class="hljs-attribute">key</span>: node-role.kubernetes.io/master<br>        <span class="hljs-attribute">effect</span>: NoSchedule<br></code></pre></div></td></tr></table></figure>

<p><strong>另外:建议直接先创建一个 deployment 然后修改 yaml 使其成为 daemonset 编排(注意删除 replicas 和其他不必要字段字段)</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs arduino">kubectl <span class="hljs-built_in">run</span> ds-kubesc12345 --<span class="hljs-built_in">image</span> nginx --<span class="hljs-built_in">image</span>-pull-policy IfNotPresent --dry-<span class="hljs-built_in">run</span> -o yaml<br></code></pre></div></td></tr></table></figure>

<p>考点：DaemonSet</p>
<p>参考：<a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/" target="_blank" rel="noopener">DaemonSet</a></p>
<h2 id="第六题-4-Rollout"><a href="#第六题-4-Rollout" class="headerlink" title="第六题 (4%) Rollout"></a>第六题 (4%) Rollout</h2><p>按如下要求创建一个 Deployment:</p>
<p>Name: nginx-app</p>
<p>Image: nginx</p>
<p>ImageTag: 1.10.2-alpine</p>
<p>Replicas: 3</p>
<p>然后，执行滚动更新，使用新版本 1.11.13-alpine 部署应用并记录此更新。</p>
<p>最后，将此更新回滚至之前版本 1.10.2-alpine</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> nginx-app <span class="hljs-attribute">--image</span>=nginx:1.10.2-alpine<br>kubectl <span class="hljs-builtin-name">set</span> image deployment nginx-app <span class="hljs-attribute">nginx-app</span>=nginx:1.11.13-alpine --record<br><span class="hljs-comment"># 直接回滚到上一个版本</span><br>kubectl rollout undo deployment nginx-app<br>kubectl rollout status -w deployment nginx-app<br><br><span class="hljs-comment"># 通过查看历史记录回滚到指定版本</span><br>kubectl rollout history deploy/nginx<br>kubectl rollout undo deploy/nginx  <span class="hljs-attribute">--to-revision</span>=2<br></code></pre></div></td></tr></table></figure>

<p>考点：资源的更新</p>
<p>参考：<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/#updating-resources" target="_blank" rel="noopener">Kubectl Cheat Sheet:Updating Resources</a></p>
<h2 id="第七题-3-Deployment"><a href="#第七题-3-Deployment" class="headerlink" title="第七题 (3%) Deployment"></a>第七题 (3%) Deployment</h2><p>创建一个 Deployment 的 spec 文件：</p>
<p>Image: nginx<br>Replicas: 4<br>Label: app_env_stage=prod<br>Name: kual12345<br>将此 spec 文件的副本保存至 /opt/dir/deployment_spec.yaml (或 .json)。</p>
<p>完成后，清理(删除)执行此任务时生成的任何新 Kubernetes API 对象。</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-string">kubectl</span> <span class="hljs-string">run</span> <span class="hljs-string">kual12345</span> <span class="hljs-string">--image</span> <span class="hljs-string">nginx</span> <span class="hljs-string">--replicas</span> <span class="hljs-number">4</span> <span class="hljs-string">--labels</span> <span class="hljs-string">app_env_stage=prod</span> <span class="hljs-string">--dry-run</span> <span class="hljs-string">-o</span> <span class="hljs-string">yaml</span><br><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app_env_stage:</span> <span class="hljs-string">prod</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kual12345</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">4</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app_env_stage:</span> <span class="hljs-string">prod</span><br>  <span class="hljs-attr">strategy:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app_env_stage:</span> <span class="hljs-string">prod</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">kual12345</span><br>        <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<h2 id="第八题-7-init-container"><a href="#第八题-7-init-container" class="headerlink" title="第八题 (7%) init container"></a>第八题 (7%) init container</h2><p>执行以下任务：</p>
<p>添加一个 init container 至 bumpy-llama (已在 spec 文件 /opt/dir/Pod-spec-12345.yaml 中定义)<br>init container 应该：创建一个名为 /workdir/faithful.txt 的 空文件<br>如果未检测到 /workdir/failthful.txt , Pod 应退出<br>一旦使用 init container 定义更新 spec 文件，则应创建 Pod</p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-attribute">apiVersion</span>: v1<br><span class="hljs-attribute">kind</span>: Pod<br><span class="hljs-attribute">metadata</span>:<br>  <span class="hljs-attribute">name</span>: hungry-bear<br><span class="hljs-attribute">spec</span>:<br>  <span class="hljs-attribute">volumes</span>:<br>  - <span class="hljs-attribute">name</span>: workdir<br>    <span class="hljs-attribute">emptyDir</span>: &#123;&#125;<br>  <span class="hljs-attribute">containers</span>:<br>  - <span class="hljs-attribute">name</span>: checker<br>    <span class="hljs-attribute">image</span>: busybox<br>    <span class="hljs-attribute">command</span>: [<span class="hljs-string">"/bin/sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"if [ -f /workdir/faithful.txt ] ; then sleep 100000; else exit 1; fi"</span>]<br>    <span class="hljs-attribute">volumeMounts</span>:<br>    - <span class="hljs-attribute">name</span>: workdir<br>      <span class="hljs-attribute">mountPath</span>: /workdir<br>  <span class="hljs-attribute">initContainers</span>:<br>  - <span class="hljs-attribute">name</span>: init-c<br>    <span class="hljs-attribute">image</span>: busybox<br>    <span class="hljs-attribute">command</span>: [<span class="hljs-string">"/bin/sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"touch /workdir/faithful.txt"</span>]<br>    <span class="hljs-attribute">volumeMounts</span>:<br>    - <span class="hljs-attribute">name</span>: workdir<br>      <span class="hljs-attribute">mountPath</span>: /workdir<br></code></pre></div></td></tr></table></figure>

<p>考点：init Container。一开始审题不仔细，以为要用到 livenessProbes</p>
<p>参考：<a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/" target="_blank" rel="noopener">init-containers</a></p>
<h2 id="第九题-9-Secret"><a href="#第九题-9-Secret" class="headerlink" title="第九题 (9%) Secret"></a>第九题 (9%) Secret</h2><p>Create a kubetnetes Secret as follows:</p>
<p>Name: super-secret</p>
<p>Credential: alice or username:bob</p>
<p>Create a Pod named pod-secrets-via-file using the redis image which mounts a secret named super-secret at /secrets</p>
<p>Create a second Pod named pod-secrets-via-env using the redis image,which exports credential/username as TOPSECRET/CREDENTIALS</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-string">生成secret参考命令</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">create</span> <span class="hljs-string">secret</span> <span class="hljs-string">generic</span> <span class="hljs-string">super-secret</span> <span class="hljs-string">--from-literal=username=bob</span>  <span class="hljs-string">--from-literal=credential=alice</span><br><span class="hljs-string">生成yaml文件的命令，再在此基础上改写(可以在https://kubernetes.io/docs/页面搜索框输入volumes查询example)</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">run</span> <span class="hljs-string">pod-secrets-via-file</span> <span class="hljs-string">--image=redis</span> <span class="hljs-string">--generator=run-pod/v1</span> <span class="hljs-string">--dry-run</span> <span class="hljs-string">-o</span> <span class="hljs-string">yaml</span> <span class="hljs-string">&gt;12-1.yml</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">pod-secrets-via-file</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">pod-secrets-via-file</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">super-secret</span><br>    <span class="hljs-attr">secret:</span><br>      <span class="hljs-attr">secretName:</span> <span class="hljs-string">super-secret</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-secrets-via-file</span><br>    <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>    <span class="hljs-attr">volumeMounts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">super-secret</span><br>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/secrets</span><br>  <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Always</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">pod-secrets-via-env</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">pod-secrets-via-env</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">super-secret</span><br>    <span class="hljs-attr">secret:</span><br>      <span class="hljs-attr">secretName:</span> <span class="hljs-string">super-secret</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-secrets-via-env</span><br>    <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>    <span class="hljs-attr">env:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CREDENTIALS</span><br>      <span class="hljs-attr">valueFrom:</span><br>        <span class="hljs-attr">secretKeyRef:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">super-secret</span><br>          <span class="hljs-attr">key:</span> <span class="hljs-string">username</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">TOPSECRET</span><br>      <span class="hljs-attr">valueFrom:</span><br>        <span class="hljs-attr">secretKeyRef:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">super-secret</span><br>          <span class="hljs-attr">key:</span> <span class="hljs-string">credential</span><br>  <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Always</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<p>参考：<a href="https://kubernetes.io/docs/concepts/configuration/secret/" target="_blank" rel="noopener">Secret</a></p>
<h2 id="第十题-4-Service"><a href="#第十题-4-Service" class="headerlink" title="第十题 (4%) Service"></a>第十题 (4%) Service</h2><p>创建和配置 front-end-service service, 以便可通过 NodePort 访问该 service 并将其路由到名为 front-end 的现有 Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl expose pod front-end <span class="hljs-attribute">--name</span>=front-end-service <span class="hljs-attribute">--type</span>=<span class="hljs-string">'NodePort'</span> <span class="hljs-attribute">--port</span>=80<br></code></pre></div></td></tr></table></figure>

<p>考点：Service</p>
<p>参考：<a href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types" target="_blank" rel="noopener">publishing-services-service-types</a></p>
<h2 id="第十一题-4-多容器-Pod"><a href="#第十一题-4-多容器-Pod" class="headerlink" title="第十一题 (4%) 多容器 Pod"></a>第十一题 (4%) 多容器 Pod</h2><p>创建一个名为 kucc3 的 Pod，在 Pod 里面分别为以下每个 image 单独运行一个 app container（可能会有 1 ～ 4 个 images）:</p>
<p>nginx + redis + memcached + consul</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># 先用命令行创建一个示例</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">run</span> <span class="hljs-string">kucc3</span> <span class="hljs-string">--image=nginx</span> <span class="hljs-string">--image-pull-policy=IfNotPresent</span> <span class="hljs-string">--replicas=1</span> <span class="hljs-string">--generator=run-pod/v1</span> <span class="hljs-string">--dry-run</span> <span class="hljs-string">-o</span> <span class="hljs-string">yaml</span><br><span class="hljs-comment"># 而后修改示例</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">kucc4</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kucc4</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">redis</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">memcached</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">memcached</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">consul</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">consul</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<p>考点：kubectl 命令熟悉程度、多个容器的 pod 的创建</p>
<p>参考：<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" rel="noopener">kubectl cheatsheet</a></p>
<h2 id="第十二题-3-Label"><a href="#第十二题-3-Label" class="headerlink" title="第十二题 (3%) Label"></a>第十二题 (3%) Label</h2><p>Create a file /opt/KUCC00302/kucc00302.txt that lists all pods that implement Service foo in Namespce production</p>
<p>The format of the file should be one pod name per line</p>
<figure class="highlight dart"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dart">[root<span class="hljs-meta">@vms</span>31 KUCC00302]# kubectl <span class="hljs-keyword">get</span> svc --<span class="hljs-keyword">show</span>-labels -n production<br>[root<span class="hljs-meta">@vms</span>31 KUCC00302]# kubectl <span class="hljs-keyword">get</span> pods -l name=haha -n production |grep -v NAME|awk <span class="hljs-string">'&#123;print <span class="hljs-subst">$1</span>&#125;'</span> &gt; /opt/KUCC00302/kucc00302.txt<br>[root<span class="hljs-meta">@vms</span>31 KUCC00302]# cat /opt/KUCC00302/kucc00302.txt<br>foo-fd6cbbd89-jdsdx<br>foo-fd6cbbd89-wrd6v<br></code></pre></div></td></tr></table></figure>

<h2 id="第十三题-2-Node-Selector"><a href="#第十三题-2-Node-Selector" class="headerlink" title="第十三题 (2%) Node Selector"></a>第十三题 (2%) Node Selector</h2><p>按如下要求调度一个 Pod：</p>
<p>名称：nginx-kucc2345<br>Image： nginx<br>Node Selector: disk=spinning</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">nginx-kucc2345</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-kucc2345</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">nginx-kucc2345</span><br>  <span class="hljs-attr">strategy:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">nginx-kucc2345</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-kucc2345</span><br>        <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">disk:</span> <span class="hljs-string">spinning</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<p>考点：pod 的调度。</p>
<p>参考：<a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">assign-pod-node</a></p>
<h2 id="第十四题-3-PV-hostPath"><a href="#第十四题-3-PV-hostPath" class="headerlink" title="第十四题 (3%) PV hostPath"></a>第十四题 (3%) PV hostPath</h2><p>创建名为 app-config 的 Persistent Volume，容量为 1Gi, 访问模式为 ReadWriteOnce。Volume 类型为 hostPath，位于 /srv/app-config。</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">apiVersion:</span> v1<br><span class="hljs-symbol">kind:</span> PersistentVolume<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  name:</span> app-config<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol">  capacity:</span><br><span class="hljs-symbol">    storage:</span> <span class="hljs-number">1</span>Gi<br><span class="hljs-symbol">  accessModes:</span><br>    - ReadWriteOnce<br><span class="hljs-symbol">  hostPath:</span><br><span class="hljs-symbol">    path:</span> <span class="hljs-meta-keyword">/srv/</span>app-config<br></code></pre></div></td></tr></table></figure>

<p>考点：创建 PV<br>参考：<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/" target="_blank" rel="noopener">persistent volumes</a></p>
<h2 id="第十五题-4-集群故障排查"><a href="#第十五题-4-集群故障排查" class="headerlink" title="第十五题 (4%) 集群故障排查"></a>第十五题 (4%) 集群故障排查</h2><p>提供一个非完全正常运行的 Kubernetes Cluster, 在该 Cluster 中找出故障征兆。</p>
<p>确定 node 和出现故障的服务，采取措施修复故障服务，使 Cluster 恢复正常。确保所有更改永久有效。</p>
<p>提示：</p>
<p>可使用 ssh node-name 通过 ssh 命令连接到相应 node<br>可使用 sudo -i 命令在该 cluster 的任何 node 上获取更高权限</p>
<figure class="highlight crmsh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crmsh">情况一<br>kubectl get cs 能看到controller manager 没有启动<br>登陆到<span class="hljs-literal">master</span>上<br>找到相关服务重启<br>systemctl <span class="hljs-literal">start</span> kube-manager-controller.service<br></code></pre></div></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">情况二<br>kubectl <span class="hljs-keyword">get</span> node显示<span class="hljs-keyword">connection</span> refuse，估计是apiserver的故障。<br>具体配置文件参考 static pod 那一题,主要解题思路如下:<br><span class="hljs-number">1.</span>为什么api-<span class="hljs-keyword">server</span>没启动 (跟其他题的集群对比发现api-<span class="hljs-keyword">server</span>配置文件相同。但是不生效)<br><span class="hljs-number">2.</span>为什么kubelet没有拉起来api-<span class="hljs-keyword">server</span>  (跟其他题的集群对比 比如static pod 那一题，可以发现kubelet没有指定静态pod目录)<br><span class="hljs-number">3.</span>kubelet配置文件中加入 (<span class="hljs-comment">--pod-manifest-path=xxxxxxx)，重启kubelet systelctl  restart  kubelet</span><br></code></pre></div></td></tr></table></figure>

<p>参考：<a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/" target="_blank" rel="noopener">Troubleshoot Clusters</a></p>
<h2 id="第十六题-4-节点故障排查"><a href="#第十六题-4-节点故障排查" class="headerlink" title="第十六题 (4%) 节点故障排查"></a>第十六题 (4%) 节点故障排查</h2><p>名为 wk8s-node-0 的 Kubernetes worker node 处于 NotReady 状态。</p>
<p>调查发生这种情况的原因，并采取相应措施将 Node 恢复为 Ready 状态，确保所做的任何更改永久有效。</p>
<p>提示：</p>
<p>可使用命令 ssh wk8s-node-0 连接到故障节点<br>可使用命令 sudo -i 在该节点上获取更高权限</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment">#查看集群状态</span><br>kubectl get nodes<br><span class="hljs-comment">#查看故障节点信息</span><br>kubectl describe node node1<br><br><span class="hljs-comment">#Message显示kubelet无法访问（记不清了）</span><br><span class="hljs-comment">#进入故障节点</span><br>ssh node1<br><br><span class="hljs-comment">#查看节点中的kubelet进程</span><br>ps -aux | grep kubelete<br><span class="hljs-comment">#没找到kubelet进程，查看kubelet服务状态</span><br>systemctl status kubelet.service<br><span class="hljs-comment">#kubelet服务没启动，启动服务并观察</span><br>systemctl start kubelet.service<br><span class="hljs-comment">#启动正常，enable服务</span><br>systemctl enable kubelet.service<br><br><span class="hljs-comment">#回到考试节点并查看状态</span><br><span class="hljs-keyword">exit</span><br><br>kubectl get nodes <span class="hljs-comment">#正常</span><br></code></pre></div></td></tr></table></figure>

<p>参考：<a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/" target="_blank" rel="noopener">Troubleshoot Clusters</a></p>
<h2 id="第十七题-8-增加节点"><a href="#第十七题-8-增加节点" class="headerlink" title="第十七题 (8%) 增加节点"></a>第十七题 (8%) 增加节点</h2><p>在本任务中，将配置一个新 Node ik8s-node-0 并将其加入一个 Kubernetes Cluster, 方法如下：</p>
<p>配置 kubelet 以便自动轮换证书，且通过使用 RBAC 确保服务器和客户端的 CSRs 能够得到自动批准和签署<br>确保创建合适的 cluster-infok ConfigMap, 并在正确的 Namespace 中进行相应的配置，以便后续的 Nodes 能够轻松加入该集群<br>用于引导的 kubeconfig 应创建在新 Node 的 /etc/kubernetes/bootstrap-kubelet.conf 上(切勿在 Node 成功加入集群后移除此文件)<br>相应的集群级 CA 证书位于 Node 的 /etc/kubernetes/pki/ca.crt 上，应确保所有自动签发的证书都安装到 Node 的 /var/lib/kubelet/pki 目录上，并且成功引导后，将在 /etc/kubernetes/kubelet.conf 渲染 kubelet 的 kubeconfig 文件<br>使用额外的组引导尝试加入集群的 Nodes，组的名称应为 system:bootstrappers:cka:default-node-token<br>解决方案应在系统启动时随着 kubelet 的 systemd service unit 文件(可在 /etc/systemd/system/kubelet.service 中找到) 一起自动启动</p>
<p>要测试解决方案，应通过位于 /opt/dir/kube-flannel.yaml 的 spec 文件创建相应的资源。该过程将创建必要的资源和 kube-flannel-ds DaemonSet。应确保将此 DaemonSet 正确部署到集群的单个(应该是每个)Node。</p>
<p>提示：</p>
<p>对于此任务，未在 ik8s-master-0 上配置或运行 kubelet, 请勿尝试配置<br>您将使用 TLS 引导来完成此任务<br>可通过以下命令获取 Kubernetes API 服务器的 IP 地址： ssh ik8s-node-0 getent hosts ik8s-master-0<br>API 服务器正在侦听常用端口 6443/tcp，且只会处理 TLS 请求<br>kubelet 二进制文件已安装到 ik8s-node-0 的 /usr/bin/kubelet 上。执行此任务期间，无需将 kube-proxy 部署到集群<br>可以使用 ssh ik8s-node-0 来连接到 Worker Node<br>可以使用 ssh ik8s-master-0 来连接到 Master Node<br>无需进一步配置在 ik8s-master-0 上运行的 Control Plane 服务<br>可使用 sudo -i 在这两个 Nodes 上获取更高权限<br>已在 ik8s-node-0 上安装并运行 Docker</p>
<p><strong>另外:可能题目有另外一种说法,就是需要你去配置 worker 节点上 kube-proxy、kubelet 的 tls</strong></p>
<p>参考：<a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/" target="_blank" rel="noopener">TLS Bootstrapping</a></p>
<h2 id="第十八题-4-Drain"><a href="#第十八题-4-Drain" class="headerlink" title="第十八题 (4%) Drain"></a>第十八题 (4%) Drain</h2><p>将标签为 ek8s-node-1 的 Node 设置为不可用，并重新调度该 Node 上所有运行的 Pods。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crmsh">kubetl get <span class="hljs-keyword">node</span> <span class="hljs-title">--show-labels</span> |grep <span class="hljs-attr">name=</span>ek8s-<span class="hljs-keyword">node</span><span class="hljs-title">-1</span><br>kubectl drain ek8s-<span class="hljs-keyword">node</span><span class="hljs-title">-1</span><br><span class="hljs-comment">#如果直接drain会出错，需要添加--ignore-daemonsets --delete-local-data参数</span><br>kubectl drain <span class="hljs-keyword">node</span> <span class="hljs-title">node1</span>  --ignore-daemonsets --delete-local-data<br></code></pre></div></td></tr></table></figure>

<p><strong>另外:使用 cordon 可以先暂停调度</strong></p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">kubectl cordon</span><br></code></pre></div></td></tr></table></figure>

<p>考点：节点调度、维护</p>
<p>参考：<a href="https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/" target="_blank" rel="noopener"> Safely Drain a Node while Respecting Application SLOs </a></p>
<h2 id="第十九题-7-Etcd"><a href="#第十九题-7-Etcd" class="headerlink" title="第十九题 (7%) Etcd"></a>第十九题 (7%) Etcd</h2><p>为在 <a href="https://127.0.0.1:2379" target="_blank" rel="noopener">https://127.0.0.1:2379</a> 运行的 etcd 实例创建快照，并将快照保存至文件路径 /data/backup/etcd-snapshot.db。</p>
<p>Etcd 实例运行的 etcd 版本为 3.3.10</p>
<p>以下 TLS 证书密钥用于通过 etcdctl 连接服务器：</p>
<p>CA 证书：/opt/dir/ca.crt<br>客户端证书：/opt/dir/etcd-client.crt<br>客户端密钥：/opt/dir/etcd-client.key</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">ETCDCTL_API</span>=3<br>etcdctl help  再etcdctl snapshot save --help<br>etcdctl <span class="hljs-attribute">--endpoints</span>=127.0.0.1:2379 <span class="hljs-attribute">--cacert</span>=/opt/dir/ca.crt <span class="hljs-attribute">--cert</span>=//opt/dir/etcd-client.crt <span class="hljs-attribute">--key</span>=/opt/dir/etcd-client.key snapshot save /data/backup/etcd-snapshot.db<br></code></pre></div></td></tr></table></figure>

<p>参考：<a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster" target="_blank" rel="noopener">backing up an etcd cluster</a></p>
<h2 id="第二十题-7-DNS"><a href="#第二十题-7-DNS" class="headerlink" title="第二十题 (7%) DNS"></a>第二十题 (7%) DNS</h2><p>按如下要求创建一个 Deployment：</p>
<p>名称：nginx-random<br>通过 Service 暴露：nginx-random<br>确保 Service 和 Pod 可通过各自的 DNS 记录访问<br>在此 Deployment 中运行的任何 Pod 内的 Container 都应使用 nginx image<br>接下来，使用实用工具 nslookup 查询该 Service 和 Pod 的 DNS 记录，并将输出结果分别写入 /opt/dir/service.dns 和 /opt/dir/Pod.dns</p>
<p>确保在任何测试中使用 busybox</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> nginx-dns <span class="hljs-attribute">--image</span>=nginx<br>kubectl expose deployment nginx-dns <span class="hljs-attribute">--port</span>=80<br>kubectl <span class="hljs-builtin-name">get</span> pods - o wide 获取pod的IP<br>kubectl <span class="hljs-builtin-name">run</span> busybox -it --rm <span class="hljs-attribute">--image</span>=busybox:1.28 sh<br>　　nslookup nginx-dns<br>　　nslookup 获取pod的IP<br></code></pre></div></td></tr></table></figure>

<p>考点：网络相关，DNS 解析</p>
<p>参考：<a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/" target="_blank" rel="noopener">Debugging DNS Resolution</a></p>
<h2 id="第二十一题-2-CPU"><a href="#第二十一题-2-CPU" class="headerlink" title="第二十一题 (2%) CPU"></a>第二十一题 (2%) CPU</h2><p>通过 Pod Label name=cpu-user，找到运行时占用大量 CPU 的 Pod，并将占用 CPU 最高的 Pod 名称写入文件 /opt/dir/1234.txt (已存在)。</p>
<figure class="highlight coq"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs coq">kubectl <span class="hljs-built_in">top</span> pod |<span class="hljs-type">grep</span> -iv name|<span class="hljs-type">sort</span> -k <span class="hljs-number">2</span> -n<br></code></pre></div></td></tr></table></figure>

<p><strong>列出 Service 名为 test 下的 pod 并找出使用 CPU 使用率最高的一个，将 pod 名称写入文件中</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-comment">#使用-o wide 获取service test的SELECTOR</span><br>kubectl <span class="hljs-builtin-name">get</span> svc test -o wide<br><span class="hljs-comment">##获取结果我就随便造了</span><br>NAME <span class="hljs-built_in"> TYPE </span>       CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE       SELECTOR<br>test  ClusterIP   None         &lt;none&gt;        3306/TCP   50d       <span class="hljs-attribute">app</span>=wordpress,tier=mysql<br><br><span class="hljs-comment">#获取对应SELECTOR的pod使用率，找到最大那个写入文件中</span><br>kubectl top test -l <span class="hljs-string">'app=wordpress,tier=mysql'</span><br></code></pre></div></td></tr></table></figure>

<p>考点：获取 service selector，kubectl top 监控 pod 资源</p>
<p>参考：<a href="https://kubernetes.io/docs/tasks/debug-application-cluster/resource-usage-monitoring" target="_blank" rel="noopener">Tools for Monitoring Resources</a></p>
<h2 id="第二十二题-2-Taint"><a href="#第二十二题-2-Taint" class="headerlink" title="第二十二题 (2%) Taint"></a>第二十二题 (2%) Taint</h2><p>检查有多少 Nodes 已准备就绪(不包括被打上 Taint: NoSchedule 的节点)，并将数量写入 /opt/dir/nodes.txt。</p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl <span class="hljs-built_in">get</span> nodes --show-labels|<span class="hljs-keyword">grep</span> -<span class="hljs-keyword">vi</span> schedule |<span class="hljs-keyword">grep</span> -<span class="hljs-keyword">vi</span> <span class="hljs-keyword">version</span> |<span class="hljs-keyword">grep</span> -i ready |wc -<span class="hljs-keyword">l</span><br><br><br>#CheatSheet方法，应该还能优化JSONPATH<br>JSONPATH=<span class="hljs-string">'&#123;range .items[*]&#125;&#123;@.metadata.name&#125;:&#123;range @.status.conditions[*]&#125;&#123;@.type&#125;=&#123;@.status&#125;;&#123;end&#125;&#123;end&#125;'</span> \<br> &amp;&amp; kubectl <span class="hljs-built_in">get</span> nodes -<span class="hljs-keyword">o</span> jsonpath=<span class="hljs-string">"$JSONPATH"</span> | <span class="hljs-keyword">grep</span> <span class="hljs-string">"Ready=True"</span><br></code></pre></div></td></tr></table></figure>

<p>考点：kubectl 命令熟悉程度</p>
<p>参考：<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" rel="noopener">kubectl cheatsheet</a></p>
<h2 id="第二十三题-1-Scale"><a href="#第二十三题-1-Scale" class="headerlink" title="第二十三题 (1%) Scale"></a>第二十三题 (1%) Scale</h2><p>Scale the deployment webserver to 6 pods</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>vms31 opt]# kubectl <span class="hljs-keyword">get</span> deployments.<br>NAME        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE<br>nginx-app   <span class="hljs-number">3</span>         <span class="hljs-number">3</span>         <span class="hljs-number">3</span>            <span class="hljs-number">3</span>           <span class="hljs-number">11</span>h<br>webserver   <span class="hljs-number">1</span>         <span class="hljs-number">1</span>         <span class="hljs-number">1</span>            <span class="hljs-number">1</span>           <span class="hljs-number">174</span>d<br>[<span class="hljs-symbol">root@</span>vms31 opt]# kubectl scale --replicas=<span class="hljs-number">6</span> deployment/webserver<br>deployment.extensions/webserver scaled<br>[<span class="hljs-symbol">root@</span>vms31 opt]# kubectl <span class="hljs-keyword">get</span> deployments.<br>NAME        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE<br>nginx-app   <span class="hljs-number">3</span>         <span class="hljs-number">3</span>         <span class="hljs-number">3</span>            <span class="hljs-number">3</span>           <span class="hljs-number">11</span>h<br>webserver   <span class="hljs-number">6</span>         <span class="hljs-number">6</span>         <span class="hljs-number">6</span>            <span class="hljs-number">1</span>           <span class="hljs-number">174</span>d<br></code></pre></div></td></tr></table></figure>

<p>考点：deployment 的 Scaling，搜索 Scaling</p>
<p>参考：<a href="https://kubernetes.io/docs/tasks/run-application/run-stateless-application-deployment/#scaling-the-application-by-increasing-the-replica-count" target="_blank" rel="noopener">Scaling the application by increasing the replica count</a></p>
<h2 id="第二十四题-4-Static-Pod"><a href="#第二十四题-4-Static-Pod" class="headerlink" title="第二十四题 (4%) Static Pod"></a>第二十四题 (4%) Static Pod</h2><p>configure the kubelet systemed managed service, on the node labelled with name=wk8s-node-1,to launch a pod containing a single container of image nginx named</p>
<p>myservice automatically.Any spec file requried should be placed in the /etc/kuberneteds/mainfests directory on the node</p>
<p>Hints:</p>
<p>You can ssh to the failed node using $ ssh wk8s-node-0</p>
<p>You can assume elevated privileges on the node with the following command $ sudo -i</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">vi /etc/systemd/system/kubelet.service<br>添加下面参数<br><span class="hljs-attribute">--pod-manifest-path</span>=/etc/kubernetes/manifests<br>使用下面的参考命令生成pod文件<br>kubectl <span class="hljs-builtin-name">run</span> myservice <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--generator</span>=run-pod/v1 --dry-<span class="hljs-builtin-name">run</span> -o yaml &gt; /etc/kubernetes/manifests/24.yml<br>重启服务<br>systemctl start kubelet<br></code></pre></div></td></tr></table></figure>

<h1 id="题库二"><a href="#题库二" class="headerlink" title="题库二"></a>题库二</h1><h2 id="第二十五题：-Ingress"><a href="#第二十五题：-Ingress" class="headerlink" title="第二十五题： Ingress"></a>第二十五题： Ingress</h2><p>部署 ingress controller，创建 ingress，域名为***，使得 curl 该域名，返回 200 ok</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># 部署ingres controller</span><br><span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-string">https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml</span><br><br><span class="hljs-comment">#创建规则</span><br><span class="hljs-string">[root@dce-bj-master-21</span> <span class="hljs-string">ingress]#</span> <span class="hljs-string">cat</span> <span class="hljs-string">ingress-rule.yml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">extensions/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Ingress</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">a2048</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">dce.daocloud.io/app:</span> <span class="hljs-string">dao-2048</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">rules:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-number">2048.</span><span class="hljs-string">fuck.you</span><br>    <span class="hljs-attr">http:</span><br>      <span class="hljs-attr">paths:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">/1</span><br>        <span class="hljs-attr">backend:</span><br>          <span class="hljs-attr">serviceName:</span> <span class="hljs-string">dao-2048</span><br>          <span class="hljs-attr">servicePort:</span> <span class="hljs-number">80</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">/2</span><br>        <span class="hljs-attr">backend:</span><br>          <span class="hljs-attr">serviceName:</span> <span class="hljs-string">dao-2049</span><br>          <span class="hljs-attr">servicePort:</span> <span class="hljs-number">80</span><br></code></pre></div></td></tr></table></figure>

<h2 id="第二十六题：Job"><a href="#第二十六题：Job" class="headerlink" title="第二十六题：Job"></a>第二十六题：Job</h2><p>创建一个固定结束次数的并行 Job，共 2 个 pod，运行 45 completion，Job pod 打印“Beijing”。镜像自选</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-string">cat</span> <span class="hljs-string">job.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">completions:</span> <span class="hljs-number">45</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> <span class="hljs-string">["echo",</span> <span class="hljs-string">"Beijing"</span><span class="hljs-string">]</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br><span class="hljs-string">[root@conn01</span> <span class="hljs-string">~]#</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">describe</span> <span class="hljs-string">job</span> <span class="hljs-string">busybox</span><br><span class="hljs-string">……</span><br><span class="hljs-attr">Pods Statuses:</span>  <span class="hljs-number">0</span> <span class="hljs-string">Running</span> <span class="hljs-string">/</span> <span class="hljs-number">45</span> <span class="hljs-string">Succeeded</span> <span class="hljs-string">/</span> <span class="hljs-number">0</span> <span class="hljs-string">Failed</span><br><span class="hljs-string">……</span><br><span class="hljs-string">[root@conn01</span> <span class="hljs-string">~]#</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">logs</span>  <span class="hljs-string">busybox-cj86j</span><br><span class="hljs-string">Beijing</span><br></code></pre></div></td></tr></table></figure>

<h2 id="第二十七题：Network"><a href="#第二十七题：Network" class="headerlink" title="第二十七题：Network"></a>第二十七题：Network</h2><p>namespace secure 中存在一个 redis 的 pod，配置该 namespace 的 network policy，拒绝其它 namespace 中的 pod 的访问，指定某一个 namespace 中的 pod 可以访问 redis pod 的 6379 端口。集群的 k8s 版本为 1.6.2。参考：<a href="https://v1-6.docs.kubernetes.io/docs/concepts/services-networking/network-policies/" target="_blank" rel="noopener">https://v1-6.docs.kubernetes.io/docs/concepts/services-networking/network-policies/</a></p>
<p><strong>创建 NameSpace 的 Policy</strong></p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">kind:</span> NetworkPolicy<br><span class="hljs-symbol">apiVersion:</span> networking.k8s.io/v1<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  namespace:</span> secure<br><span class="hljs-symbol">  name:</span> deny-other-namespaces<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol">  podSelector:</span> &#123;&#125;<br><span class="hljs-symbol">  policyTypes:</span><br>  - Ingress<br></code></pre></div></td></tr></table></figure>

<p><strong>创建 POD 和 POD 的 Policy</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">networking.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">NetworkPolicy</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test-network-policy</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">secure</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">podSelector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">role:</span> <span class="hljs-string">redis</span><br>  <span class="hljs-attr">policyTypes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">Ingress</span><br>  <span class="hljs-attr">ingress:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">from:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">namespaceSelector:</span><br>        <span class="hljs-attr">matchLabels:</span><br>          <span class="hljs-attr">project:</span> <span class="hljs-string">myproject</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">podSelector:</span><br>        <span class="hljs-attr">matchLabels:</span><br>          <span class="hljs-attr">role:</span> <span class="hljs-string">frontend</span><br>    <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br></code></pre></div></td></tr></table></figure>

<h2 id="第二十八题：Annotation"><a href="#第二十八题：Annotation" class="headerlink" title="第二十八题：Annotation"></a>第二十八题：Annotation</h2><p>创建一个 deployment，该 deployment 具有 app=***的 annotation，将 deployment 的 yaml 文件保存至指定目录</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">kubectl annotate deploy <span class="hljs-built_in">test</span>-alpine app=<span class="hljs-string">'ckaexam'</span><br></code></pre></div></td></tr></table></figure>

<h2 id="第二十九题：RBAC"><a href="#第二十九题：RBAC" class="headerlink" title="第二十九题：RBAC"></a>第二十九题：RBAC</h2><p>使用 rbac 资源，包括 role、rolebinding 等，具体可参考官方文档</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">读取ns default下的 Pod 的权限和列出 Pod 的权限<br>kind: Role<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  namespace: default<br>  name: pod-reader<br>rules:<br>- apiGroups: [<span class="hljs-string">""</span>] #<span class="hljs-string">""</span> indicates the core API group<br>  resources: [<span class="hljs-string">"pods"</span>]<br>  verbs: [<span class="hljs-string">"get"</span>, <span class="hljs-string">"watch"</span>, <span class="hljs-string">"list"</span>]<br><br>给用户jane读取ns default下的 Pod 的权限和列出 Pod 的权限<br>kind: RoleBinding<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: read-pods<br>  namespace: default<br>subjects:<br>- kind: User<br>  name: jane<br>  apiGroup: rbac.authorization.k8s.io<br>roleRef:<br>  kind: Role<br>  name: pod-reader<br>  apiGroup: rbac.authorization.k8s.io<br></code></pre></div></td></tr></table></figure>

<h2 id="第三十题：Network"><a href="#第三十题：Network" class="headerlink" title="第三十题：Network"></a>第三十题：Network</h2><p>登陆另一集群，该集群未配置网络，选择 calico 配置集群网络。创建 pod，配置 network policy。可参考 k8s 官网 network policy</p>
<p><strong>参考:</strong></p>
<p><a href="http://dwiki.daocloud.io/pages/viewpage.action?pageId=13060400" target="_blank" rel="noopener">http://dwiki.daocloud.io/pages/viewpage.action?pageId=13060400</a></p>
<p><a href="https://blog.csdn.net/deerjoe/article/details/86300826" target="_blank" rel="noopener">https://blog.csdn.net/deerjoe/article/details/86300826</a></p>
<p><a href="https://www.cncf.io/certification/cka/faq/" target="_blank" rel="noopener">https://www.cncf.io/certification/cka/faq/</a></p>
<p><a href="https://www.cnblogs.com/mustark/articles/11133539.html" target="_blank" rel="noopener">https://www.cnblogs.com/mustark/articles/11133539.html</a> (最全)</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AE%B9%E5%99%A8/">容器</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/CKA/">CKA</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/11/25/ip%E5%8D%8F%E8%AE%AE%E7%B0%87/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ip协议簇</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/11/15/%E6%A0%91%E8%8E%93%E6%B4%BEzerow%E4%BD%BF%E7%94%A8/">
                        <span class="hidden-mobile">树莓派zerow使用</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
