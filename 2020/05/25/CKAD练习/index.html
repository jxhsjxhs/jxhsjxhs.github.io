

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;light&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="jame_xhs">
  <meta name="keywords" content="">
  <title>CKAD练习 - jame_xhs&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.jxhs.me","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>jame_xhs blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/more-order/">
                <i class="iconfont icon-slack-fill"></i>
                越阶计划
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                书单
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/book-2021/">
                    
                    2021
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/book-2020/">
                    
                    2020
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="CKAD练习">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-05-25 23:17" pubdate>
        2020年5月25日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      90
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">CKAD练习</h1>
            
            <div class="markdown-body">
              <h2 id="Kubernetes-CKAD-练习"><a href="#Kubernetes-CKAD-练习" class="headerlink" title="Kubernetes CKAD 练习"></a>Kubernetes CKAD 练习</h2><h3 id="核心概念（13％）"><a href="#核心概念（13％）" class="headerlink" title="核心概念（13％）"></a>核心概念（13％）</h3><h3 id="多容器-Pod（10％）"><a href="#多容器-Pod（10％）" class="headerlink" title="多容器 Pod（10％）"></a>多容器 Pod（10％）</h3><h3 id="Pod-设计（20％）"><a href="#Pod-设计（20％）" class="headerlink" title="Pod 设计（20％）"></a>Pod 设计（20％）</h3><h3 id="状态持久性（8％）"><a href="#状态持久性（8％）" class="headerlink" title="状态持久性（8％）"></a>状态持久性（8％）</h3><h3 id="配置（18％）"><a href="#配置（18％）" class="headerlink" title="配置（18％）"></a>配置（18％）</h3><h3 id="可观察性（18％）"><a href="#可观察性（18％）" class="headerlink" title="可观察性（18％）"></a>可观察性（18％）</h3><h3 id="服务和网络（13％）"><a href="#服务和网络（13％）" class="headerlink" title="服务和网络（13％）"></a>服务和网络（13％）</h3><h3 id="了解-Kubernetes-API-原语，创建和配置基本-Pod"><a href="#了解-Kubernetes-API-原语，创建和配置基本-Pod" class="headerlink" title="了解 Kubernetes API 原语，创建和配置基本 Pod"></a>了解 Kubernetes API 原语，创建和配置基本 Pod</h3><ol>
<li><p>列出集群中的所有命名空间</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> namespaces<br>kubectl <span class="hljs-builtin-name">get</span> ns<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>列出所有命名空间中的所有 Pod</p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl <span class="hljs-built_in">get</span> <span class="hljs-keyword">po</span> --<span class="hljs-keyword">all</span>-namespaces<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>列出特定命名空间中的所有 Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> pod -n kube-system<br>kubectl <span class="hljs-builtin-name">get</span> pod -n 命名空间名称<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>列出特定命名空间中的所有 Service</p>
<figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">kubectl</span> <span class="hljs-meta">get</span> <span class="hljs-keyword">svc </span>--all-namespaces<br><span class="hljs-symbol">kubectl</span> <span class="hljs-meta">get</span> <span class="hljs-keyword">svc </span>-n 命名空间名称<br><span class="hljs-symbol">kubectl</span> <span class="hljs-meta">get</span> <span class="hljs-keyword">svc </span>-n default<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>用 json 路径表达式列出所有显示名称和命名空间的 Pod</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">kubectl get pods -o=jsonpath="&#123;. items[<span class="hljs-string">*</span>][<span class="hljs-symbol">'metadata. name','metadata. namespace'</span>]&#125;" --all-namespaces --sort-by=metadata. name<br><br>kubectl get pods -o=jsonpath="&#123;. items[<span class="hljs-string">*</span>][<span class="hljs-symbol">'metadata. name','metadata. namespace'</span>]&#125;" --all-namespaces<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>在默认命名空间中创建一个 Nginx Pod，并验证 Pod 是否正在运行</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> nginx <span class="hljs-attribute">--image</span>=nginx<br>以上命令<br>kubectl <span class="hljs-builtin-name">run</span> <span class="hljs-attribute">--generator</span>=deployment/apps. v1 is DEPRECATED <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">in</span> a future version.  Use kubectl <span class="hljs-builtin-name">run</span> <span class="hljs-attribute">--generator</span>=run-pod/v1 <span class="hljs-keyword">or</span> kubectl create instead<br><br>kubectl <span class="hljs-builtin-name">run</span> nginx <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never<br>会直接产生 nginx  后面不会产生随机数<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>使用 yaml 文件创建相同的 Nginx Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> nginx <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never --dry-<span class="hljs-builtin-name">run</span> -o yaml &gt; nginx. yaml<br><br>nginx. yaml 为<br></code></pre></div></td></tr></table></figure>

</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>


<ol start="8">
<li>输出刚创建的 Pod 的 yaml 文件<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> po nginx -o yaml<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="9">
<li>输出刚创建的 Pod 的 yaml 文件，并且其中不包含特定于集群的信息</li>
</ol>
<p>kubectl get po nginx -o yaml –export</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-string">Flag</span> <span class="hljs-string">--export</span> <span class="hljs-string">has</span> <span class="hljs-string">been</span> <span class="hljs-string">deprecated,</span> <span class="hljs-string">This</span> <span class="hljs-string">flag</span> <span class="hljs-string">is</span> <span class="hljs-string">deprecated</span> <span class="hljs-string">and</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">removed</span> <span class="hljs-string">in</span> <span class="hljs-string">future.</span> <br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">annotations:</span><br>    <span class="hljs-attr">cni. projectcalico. org/podIP:</span> <span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-number">244</span><span class="hljs-string">.</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-number">4</span><span class="hljs-string">/32</span><br>    <span class="hljs-attr">cni. projectcalico. org/podIPs:</span> <span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-number">244</span><span class="hljs-string">.</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-number">4</span><span class="hljs-string">/32</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">selfLink:</span> <span class="hljs-string">/api/v1/namespaces/default/pods/nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">Always</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>    <span class="hljs-attr">terminationMessagePath:</span> <span class="hljs-string">/dev/termination-log</span><br>    <span class="hljs-attr">terminationMessagePolicy:</span> <span class="hljs-string">File</span><br>    <span class="hljs-attr">volumeMounts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/run/secrets/kubernetes.</span> <span class="hljs-string">io/serviceaccount</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">default-token-6t2vf</span><br>      <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>  <span class="hljs-attr">enableServiceLinks:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">nodeName:</span> <span class="hljs-string">k8s-node01</span><br>  <span class="hljs-attr">priority:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br>  <span class="hljs-attr">schedulerName:</span> <span class="hljs-string">default-scheduler</span><br>  <span class="hljs-attr">securityContext:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">serviceAccount:</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">30</span><br>  <span class="hljs-attr">tolerations:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">effect:</span> <span class="hljs-string">NoExecute</span><br>    <span class="hljs-attr">key:</span> <span class="hljs-string">node.</span> <span class="hljs-string">kubernetes.</span> <span class="hljs-string">io/not-ready</span><br>    <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span><br>    <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">300</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">effect:</span> <span class="hljs-string">NoExecute</span><br>    <span class="hljs-attr">key:</span> <span class="hljs-string">node.</span> <span class="hljs-string">kubernetes.</span> <span class="hljs-string">io/unreachable</span><br>    <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span><br>    <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">300</span><br>  <span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">default-token-6t2vf</span><br>    <span class="hljs-attr">secret:</span><br>      <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">420</span><br>      <span class="hljs-attr">secretName:</span> <span class="hljs-string">default-token-6t2vf</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">phase:</span> <span class="hljs-string">Pending</span><br>  <span class="hljs-attr">qosClass:</span> <span class="hljs-string">BestEffort</span><br></code></pre></div></td></tr></table></figure>

<ol start="10">
<li>获取刚刚创建的 Pod 的完整详细信息</li>
</ol>
<p>kubectl describe pod nginx</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">Name:</span>         <span class="hljs-string">nginx</span><br><span class="hljs-attr">Namespace:</span>    <span class="hljs-string">default</span><br><span class="hljs-attr">Priority:</span>     <span class="hljs-number">0</span><br><span class="hljs-attr">Node:</span>         <span class="hljs-string">k8s-node01/192.</span> <span class="hljs-number">168</span><span class="hljs-string">.</span> <span class="hljs-number">17</span><span class="hljs-string">.</span> <span class="hljs-number">151</span><br><span class="hljs-attr">Start Time:</span>   <span class="hljs-string">Sun,</span> <span class="hljs-number">05</span> <span class="hljs-string">Jan</span> <span class="hljs-number">2020</span> <span class="hljs-number">18</span><span class="hljs-string">:57:52</span> <span class="hljs-number">-0800</span><br><span class="hljs-attr">Labels:</span>       <span class="hljs-string">run=nginx</span><br><span class="hljs-attr">Annotations:  cni. projectcalico. org/podIP:</span> <span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-number">244</span><span class="hljs-string">.</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-number">4</span><span class="hljs-string">/32</span><br>              <span class="hljs-attr">cni. projectcalico. org/podIPs:</span> <span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-number">244</span><span class="hljs-string">.</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-number">4</span><span class="hljs-string">/32</span><br><span class="hljs-attr">Status:</span>       <span class="hljs-string">Running</span><br><span class="hljs-attr">IP:</span>           <span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-number">244</span><span class="hljs-string">.</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-number">4</span><br><span class="hljs-attr">IPs:</span><br>  <span class="hljs-attr">IP:</span>  <span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-number">244</span><span class="hljs-string">.</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-number">4</span><br><span class="hljs-attr">Containers:</span><br>  <span class="hljs-attr">nginx:</span><br>    <span class="hljs-attr">Container ID:</span>   <span class="hljs-string">docker://3d9b8b7aba7c10b3f1fbdd470dee702bc5c0e70a46157674574b3b20bd629335</span><br>    <span class="hljs-attr">Image:</span>          <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">Image ID:</span>       <span class="hljs-string">docker-pullable://nginx@sha256:b2d89d0a210398b4d1120b3e3a7672c16a4ba09c2c4a0395f18b9f7999b768f2</span><br>    <span class="hljs-attr">Port:</span>           <span class="hljs-string">&lt;none&gt;</span><br>    <span class="hljs-attr">Host Port:</span>      <span class="hljs-string">&lt;none&gt;</span><br>    <span class="hljs-attr">State:</span>          <span class="hljs-string">Running</span><br>      <span class="hljs-attr">Started:</span>      <span class="hljs-string">Sun,</span> <span class="hljs-number">05</span> <span class="hljs-string">Jan</span> <span class="hljs-number">2020</span> <span class="hljs-number">18</span><span class="hljs-string">:57:57</span> <span class="hljs-number">-0800</span><br>    <span class="hljs-attr">Ready:</span>          <span class="hljs-literal">True</span><br>    <span class="hljs-attr">Restart Count:</span>  <span class="hljs-number">0</span><br>    <span class="hljs-attr">Environment:</span>    <span class="hljs-string">&lt;none&gt;</span><br>    <span class="hljs-attr">Mounts:</span><br>      <span class="hljs-string">/var/run/secrets/kubernetes.</span> <span class="hljs-string">io/serviceaccount</span> <span class="hljs-string">from</span> <span class="hljs-string">default-token-6t2vf</span> <span class="hljs-string">(ro)</span><br><span class="hljs-attr">Conditions:</span><br>  <span class="hljs-string">Type</span>              <span class="hljs-string">Status</span><br>  <span class="hljs-string">Initialized</span>       <span class="hljs-literal">True</span> <br>  <span class="hljs-string">Ready</span>             <span class="hljs-literal">True</span> <br>  <span class="hljs-string">ContainersReady</span>   <span class="hljs-literal">True</span> <br>  <span class="hljs-string">PodScheduled</span>      <span class="hljs-literal">True</span> <br><span class="hljs-attr">Volumes:</span><br>  <span class="hljs-attr">default-token-6t2vf:</span><br>    <span class="hljs-attr">Type:</span>        <span class="hljs-string">Secret</span> <span class="hljs-string">(a</span> <span class="hljs-string">volume</span> <span class="hljs-string">populated</span> <span class="hljs-string">by</span> <span class="hljs-string">a</span> <span class="hljs-string">Secret)</span><br>    <span class="hljs-attr">SecretName:</span>  <span class="hljs-string">default-token-6t2vf</span><br>    <span class="hljs-attr">Optional:</span>    <span class="hljs-literal">false</span><br><span class="hljs-attr">QoS Class:</span>       <span class="hljs-string">BestEffort</span><br><span class="hljs-attr">Node-Selectors:</span>  <span class="hljs-string">&lt;none&gt;</span><br><span class="hljs-attr">Tolerations:</span>     <span class="hljs-string">node.</span> <span class="hljs-string">kubernetes.</span> <span class="hljs-string">io/not-ready:NoExecute</span> <span class="hljs-string">for</span> <span class="hljs-string">300s</span><br>                 <span class="hljs-string">node.</span> <span class="hljs-string">kubernetes.</span> <span class="hljs-string">io/unreachable:NoExecute</span> <span class="hljs-string">for</span> <span class="hljs-string">300s</span><br><span class="hljs-attr">Events:</span><br>  <span class="hljs-string">Type</span>    <span class="hljs-string">Reason</span>     <span class="hljs-string">Age</span>   <span class="hljs-string">From</span>                 <span class="hljs-string">Message</span><br>  <span class="hljs-string">----</span>    <span class="hljs-string">------</span>     <span class="hljs-string">----</span>  <span class="hljs-string">----</span>                 <span class="hljs-string">-------</span><br>  <span class="hljs-string">Normal</span>  <span class="hljs-string">Scheduled</span>  <span class="hljs-string">14m</span>   <span class="hljs-string">default-scheduler</span>    <span class="hljs-string">Successfully</span> <span class="hljs-string">assigned</span> <span class="hljs-string">default/nginx</span> <span class="hljs-string">to</span> <span class="hljs-string">k8s-node01</span><br>  <span class="hljs-string">Normal</span>  <span class="hljs-string">Pulling</span>    <span class="hljs-string">14m</span>   <span class="hljs-string">kubelet,</span> <span class="hljs-string">k8s-node01</span>  <span class="hljs-string">Pulling</span> <span class="hljs-string">image</span> <span class="hljs-string">"nginx"</span><br>  <span class="hljs-string">Normal</span>  <span class="hljs-string">Pulled</span>     <span class="hljs-string">14m</span>   <span class="hljs-string">kubelet,</span> <span class="hljs-string">k8s-node01</span>  <span class="hljs-string">Successfully</span> <span class="hljs-string">pulled</span> <span class="hljs-string">image</span> <span class="hljs-string">"nginx"</span><br>  <span class="hljs-string">Normal</span>  <span class="hljs-string">Created</span>    <span class="hljs-string">14m</span>   <span class="hljs-string">kubelet,</span> <span class="hljs-string">k8s-node01</span>  <span class="hljs-string">Created</span> <span class="hljs-string">container</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-string">Normal</span>  <span class="hljs-string">Started</span>    <span class="hljs-string">14m</span>   <span class="hljs-string">kubelet,</span> <span class="hljs-string">k8s-node01</span>  <span class="hljs-string">Started</span> <span class="hljs-string">container</span> <span class="hljs-string">nginx</span><br></code></pre></div></td></tr></table></figure>

<ol start="11">
<li>删除刚创建的 Pod</li>
</ol>
<figure class="highlight actionscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs actionscript">kubectl <span class="hljs-keyword">delete</span> pod nginx<br>kubectl <span class="hljs-keyword">delete</span> -f yaml 文件<br></code></pre></div></td></tr></table></figure>

<ol start="12">
<li>强制删除刚创建的 Pod</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl delete po nginx <span class="hljs-attribute">--grace-period</span>=0 --force<br><br>warning: Immediate deletion does <span class="hljs-keyword">not</span> wait <span class="hljs-keyword">for</span> confirmation that the running<span class="hljs-built_in"> resource </span>has been terminated.  The<span class="hljs-built_in"> resource </span>may continue <span class="hljs-keyword">to</span> <span class="hljs-builtin-name">run</span> on the cluster indefinitely. <br>pod <span class="hljs-string">"nginx"</span> force deleted<br></code></pre></div></td></tr></table></figure>

<ol start="13">
<li>创建版本为 1. 17. 4 的 Nginx Pod，并将其暴露在端口 80 上</li>
</ol>
<p>kubectl run nginx –image=nginx:1. 17. 4 –restart=Never –port=80</p>
<p>kubectl run nginx –image=nginx:1. 17. 4 –restart=Never –port=80 –dry-run -o yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.</span> <span class="hljs-number">17</span><span class="hljs-string">.</span> <span class="hljs-number">4</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<ol start="14">
<li><p>将刚创建的容器的镜像更改为 1. 15-alpine，并验证该镜像是否已更新</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><br>kubectl <span class="hljs-builtin-name">set</span> image pod/nginx <span class="hljs-attribute">nginx</span>=nginx:1. 15-alpine<br><br>kubectl <span class="hljs-builtin-name">edit</span> po nginx<br><br>kubectl <span class="hljs-builtin-name">get</span> po nginx -w<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>对于刚刚更新的 Pod，将镜像版本改回 1. 17. 1，并观察变化</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><br>kubectl <span class="hljs-builtin-name">set</span> image pod/nginx <span class="hljs-attribute">nginx</span>=nginx:1. 17. 1<br><br>kubectl <span class="hljs-builtin-name">edit</span> po nginx<br><br>kubectl <span class="hljs-builtin-name">get</span> po nginx -w<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>在不用 describe 命令的情况下检查镜像版本</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><br>kubectl <span class="hljs-builtin-name">get</span> po nginx <span class="hljs-attribute">-o</span>=jsonpath='&#123;. spec. containers[]. image&#125;&#123;<span class="hljs-string">"\n"</span>&#125;<span class="hljs-string">'</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>创建 Nginx Pod 并在 Pod 上执行简单的 shell</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> nginx <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never<br>kubectl exec -it nginx /bin/bash<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获取刚刚创建的 Pod 的 IP 地址</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> po nginx -o wide<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>创建一个 busybox Pod，在创建它时运行命令 ls 并检查日志</p>
</li>
</ol>
<p>kubectl run busybox –image=busybox –restart=Never – ls</p>
<p>kubectl logs busybox</p>
<figure class="highlight tcl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs tcl">bin<br>dev<br>etc<br>home<br><span class="hljs-keyword">proc</span><br>root<br>sys<br>tmp<br>usr<br>var<br></code></pre></div></td></tr></table></figure>

<ol start="20">
<li>如果 Pod 崩溃了，请检查 Pod 的先前日志<figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">kubectl</span> logs <span class="hljs-keyword">busybox </span>-p<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="21">
<li><p>用命令 sleep 3600 创建一个 busybox Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> busybox <span class="hljs-attribute">--image</span>=busybox <span class="hljs-attribute">--restart</span>=Never -- /bin/sh -c <span class="hljs-string">"sleep 3600"</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>检查 busybox Pod 中 Nginx Pod 的连接</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> pod nginx -o wide<br><br>kubectl exec -it busybox -- wget -o- 上述命令列出的<span class="hljs-built_in"> ip </span>地址<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="23">
<li>创建一个能回显消息“How are you”的 busybox Pod，并手动将其删除<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> busybox <span class="hljs-attribute">--image</span>=busybox <span class="hljs-attribute">--restart</span>=Never -it -- echo <span class="hljs-string">"How are you"</span><br>kubectl delete po busybox<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="24">
<li>创建一个 Nginx Pod 并列出具有不同复杂度（verbosity）的 Pod</li>
</ol>
<p>kubectl run nginx –image=nginx –restart=Never –port=80<br>kubectl get po nginx –v=7</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">I0105 <span class="hljs-number">20</span>:<span class="hljs-number">54</span>:<span class="hljs-number">25.780863</span>  <span class="hljs-number">118442</span> loader.go:<span class="hljs-number">375</span>] Config loaded <span class="hljs-keyword">from</span> file:  /home/k8s-master/.kube/config<br>I0105 <span class="hljs-number">20</span>:<span class="hljs-number">54</span>:<span class="hljs-number">25.790538</span>  <span class="hljs-number">118442</span> round_trippers.go:<span class="hljs-number">420</span>] GET https:<span class="hljs-comment">//192.168.17.150:6443/api/v1/namespaces/default/pods/nginx</span><br>I0105 <span class="hljs-number">20</span>:<span class="hljs-number">54</span>:<span class="hljs-number">25.790575</span>  <span class="hljs-number">118442</span> round_trippers.go:<span class="hljs-number">427</span>] Request Headers:<br>I0105 <span class="hljs-number">20</span>:<span class="hljs-number">54</span>:<span class="hljs-number">25.790584</span>  <span class="hljs-number">118442</span> round_trippers.go:<span class="hljs-number">431</span>]     Accept: application/json;as=Table;v=v1beta1;g=meta.k8s.io, application/json<br>I0105 <span class="hljs-number">20</span>:<span class="hljs-number">54</span>:<span class="hljs-number">25.790591</span>  <span class="hljs-number">118442</span> round_trippers.go:<span class="hljs-number">431</span>]     User-Agent: kubectl/v1<span class="hljs-number">.16</span><span class="hljs-number">.3</span> (linux/amd64) kubernetes/b3cbbae<br>I0105 <span class="hljs-number">20</span>:<span class="hljs-number">54</span>:<span class="hljs-number">25.797321</span>  <span class="hljs-number">118442</span> round_trippers.go:<span class="hljs-number">446</span>] Response Status: <span class="hljs-number">200</span> OK <span class="hljs-keyword">in</span> <span class="hljs-number">6</span> milliseconds<br>NAME    READY   STATUS    RESTARTS   AGE<br>nginx   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">3</span>          <span class="hljs-number">91</span>m<br></code></pre></div></td></tr></table></figure>

<ol start="25">
<li>使用自定义列 PODNAME 和 PODSTATUS 列出 Nginx Pod</li>
</ol>
<p>kubectl get po nginx -o=custom-columns=”POD_NAME:.metadata.name,POD_STATUS:.status.containerStatuses”</p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">nginx      [<span class="hljs-keyword">map</span>[containerID:docker://<span class="hljs-number">9</span>ff65fc8e8771aa9bc069735a7d9bffa915737cdc8da2f491e330c9c11082ebb image:nginx:latest imageID:docker-pullable://nginx@sha256:b2d89d0a210398b4d1120b3e3a7672c16a4ba09c2c4a0395f18b9f7999b768f2 lastState:<span class="hljs-keyword">map</span>[terminated:<span class="hljs-keyword">map</span>[containerID:docker://ade08d0814b2073079bbad9ebf51b3a3fa2af2df4a411f99b255a78d3b669eeb exitCode:<span class="hljs-number">0</span> finishedA<span class="hljs-variable">t:2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">06</span>T03:<span class="hljs-number">34</span>:<span class="hljs-number">31</span>Z reason:Completed startedA<span class="hljs-variable">t:2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">06</span>T03:<span class="hljs-number">31</span>:<span class="hljs-number">59</span>Z]] name:nginx ready:true restartCoun<span class="hljs-variable">t:3</span> started:true state:<span class="hljs-keyword">map</span>[runnin<span class="hljs-variable">g:map</span>[startedA<span class="hljs-variable">t:2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">06</span>T03:<span class="hljs-number">34</span>:<span class="hljs-number">31</span>Z]]]]<br></code></pre></div></td></tr></table></figure>

<ol start="26">
<li><p>列出所有按名称排序的 Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> po <span class="hljs-attribute">--sort-by</span>=.metadata.name<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>列出所有按创建时间排序的 Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> po <span class="hljs-attribute">--sort-by</span>=.metadata.creationTimestamp<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="28">
<li>用“ls; sleep 3600;”“echo Hello World; sleep 3600;”及“echo this is the third container; sleep 3600”三个命令创建一个包含三个 busybox 容器的 Pod，并观察其状态</li>
</ol>
<p>sudo vim multi-containers.yaml</p>
<p>apiVersion: v1<br>kind: Pod<br>metadata:<br>  creationTimestamp: null<br>  labels:<br>    run: busybox<br>  name: busybox<br>spec:<br>  containers:</p>
<ul>
<li>args:<ul>
<li>bin/sh</li>
<li>-c</li>
<li>ls; sleep 3600<br>image: busybox<br>name: busybox1<br>resources: {}</li>
</ul>
</li>
<li>args:<ul>
<li>bin/sh</li>
<li>-c</li>
<li>echo Hello World;sleep 3600<br>image: busybox<br>name: busybox2<br>resources: {}</li>
</ul>
</li>
<li>args:<ul>
<li>bin/sh</li>
<li>-c</li>
<li>echo this is third containers;sleep 3600<br>image: busybox<br>name: busybox3<br>resources: {}<br>dnsPolicy: ClusterFirst<br>restartPolicy: Never<br>status: {}</li>
</ul>
</li>
</ul>
<ol start="29">
<li>检查刚创建的每个容器的日志<figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">kubectl</span> <span class="hljs-meta">get</span> po<br><br><span class="hljs-symbol">kubectl</span> logs <span class="hljs-keyword">busybox </span>-c <span class="hljs-keyword">busybox1</span><br><span class="hljs-keyword">kubectl </span>logs <span class="hljs-keyword">busybox </span>-c <span class="hljs-keyword">busybox2</span><br><span class="hljs-keyword">kubectl </span>logs <span class="hljs-keyword">busybox </span>-c <span class="hljs-keyword">busybox3</span><br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="30">
<li><p>检查第二个容器 busybox2 的先前日志（如果有）</p>
<figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">kubectl</span> logs <span class="hljs-keyword">busybox </span>-c <span class="hljs-keyword">busybox2 </span>--previous<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>在上述容器的第三个容器 busybox3 中运行命令 ls</p>
<figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">kubectl</span> exec <span class="hljs-keyword">busybox </span>-c <span class="hljs-keyword">busybox3 </span>-- ls<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>显示以上容器的 metrics，将其放入 file.log 中并进行验证</p>
<figure class="highlight stata"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata">kubectl top pod busybox --containers &gt; <span class="hljs-keyword">file</span>.<span class="hljs-keyword">log</span> &amp;&amp; <span class="hljs-keyword">cat</span> <span class="hljs-keyword">file</span>.<span class="hljs-keyword">log</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>用主容器 busybox 创建一个 Pod，并执行“while true; do echo ‘Hi I am from Main container’ &gt;&gt; /var/log/index.html; sleep 5; done”，并带有暴露在端口 80 上的 Nginx 镜像的 sidecar 容器。用 emptyDir Volume 将该卷安装在 /var/log 路径（用于 busybox）和 /usr/share/nginx/html 路径（用于nginx容器）。验证两个容器都在运行。</p>
</li>
</ol>
<p>kubectl run muilti-containers-pod –image=busybox –restart=Never –dry-run -o yaml &gt; nulti-containers-pod.yaml</p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-attribute">apiVersion</span>: v1<br><span class="hljs-attribute">kind</span>: Pod<br><span class="hljs-attribute">metadata</span>:<br>  <span class="hljs-attribute">creationTimestamp</span>: null<br>  <span class="hljs-attribute">labels</span>:<br>    <span class="hljs-attribute">run</span>: muilti-containers-pod<br>  <span class="hljs-attribute">name</span>: muilti-containers-pod<br><span class="hljs-attribute">spec</span>:<br>  <span class="hljs-attribute">volumes</span>: <br>  - <span class="hljs-attribute">name</span>: var-logs<br>    <span class="hljs-attribute">emptyDir</span>: &#123;&#125;<br>  <span class="hljs-attribute">containers</span>:<br>  - <span class="hljs-attribute">image</span>: busybox<br>    <span class="hljs-attribute">command</span>: [<span class="hljs-string">"/bin/sh"</span>]<br>    <span class="hljs-attribute">args</span>: [<span class="hljs-string">"-c"</span>, <span class="hljs-string">"while true; do echo 'Hi I am from Main container' &gt;&gt; /var/log/index.html; sleep 5; done"</span>]<br>    <span class="hljs-attribute">name</span>: main-containers<br>    <span class="hljs-attribute">resources</span>: &#123;&#125;<br>    <span class="hljs-attribute">volumeMounts</span>: <br>    - <span class="hljs-attribute">name</span>: var-logs<br>      <span class="hljs-attribute">mountPath</span>: /var/log<br>  - <span class="hljs-attribute">image</span>: nginx<br>    <span class="hljs-attribute">name</span>: sidercar-container<br>    <span class="hljs-attribute">resources</span>: &#123;&#125;<br>    <span class="hljs-attribute">ports</span>: <br>      - <span class="hljs-attribute">containerPort</span>: <span class="hljs-number">80</span><br>    <span class="hljs-attribute">volumeMounts</span>: <br>    - <span class="hljs-attribute">name</span>: var-logs<br>      <span class="hljs-attribute">mountPath</span>: /usr/share/nginx/html<br>  <span class="hljs-attribute">dnsPolicy</span>: ClusterFirst<br>  <span class="hljs-attribute">restartPolicy</span>: Never<br><span class="hljs-attribute">status</span>: &#123;&#125;<br></code></pre></div></td></tr></table></figure>
<p>kubectl create -f multi-containers-pod.yaml</p>
<ol start="34">
<li><p>进入两个容器并验证 main.txt 是否存在，并用 curl localhost 从 sidecar 容器中查询 main. txt</p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl exec -it muilti-containers-pod -<span class="hljs-keyword">c</span> main-container -- <span class="hljs-keyword">sh</span><br><span class="hljs-keyword">cat</span> var/<span class="hljs-built_in">log</span>/<span class="hljs-built_in">index</span>.html<br>kubectl exec -it muilti-containers-pod -<span class="hljs-keyword">c</span> sidercar-container -- <span class="hljs-keyword">sh</span><br><span class="hljs-keyword">cat</span> /usr/share/nginx/html/<span class="hljs-built_in">index</span>.html<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获取带有标签信息的 Pod</p>
<figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima">kubectl <span class="hljs-built_in">get</span> po --<span class="hljs-built_in">show</span>-<span class="hljs-built_in">labels</span><br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="36">
<li>创建 5 个 Nginx Pod，其中两个标签为 env = prod，另外三个标签为 env = dev<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">run</span> nginx-dev1 <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never <span class="hljs-attribute">--labels</span>=env=dev<br>kubectl <span class="hljs-builtin-name">run</span> nginx-dev2 <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never <span class="hljs-attribute">--labels</span>=env=dev<br>kubectl <span class="hljs-builtin-name">run</span> nginx-dev3 <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never <span class="hljs-attribute">--labels</span>=env=dev<br>kubectl <span class="hljs-builtin-name">run</span> nginx-pro1 <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never <span class="hljs-attribute">--labels</span>=env=pro<br>kubectl <span class="hljs-builtin-name">run</span> nginx-pro2 <span class="hljs-attribute">--image</span>=nginx <span class="hljs-attribute">--restart</span>=Never <span class="hljs-attribute">--labels</span>=env=pro<br></code></pre></div></td></tr></table></figure></li>
<li>确认所有 Pod 都使用正确的标签创建</li>
</ol>
<p>kubectl get po –show-labels</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">nginx-dev1                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m2s    env=dev<br>nginx-dev2                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">63</span>s     env=dev<br>nginx-dev3                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">57</span>s     env=dev<br>nginx-pro1                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">52</span>s     env=pro<br>nginx-pro2                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">46</span>s     env=pro<br></code></pre></div></td></tr></table></figure>

<ol start="38">
<li>获得带有标签 env=dev 的 Pod</li>
</ol>
<p>kubectl get pods -l env=dev</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">nginx-dev1   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m55s<br>nginx-dev2   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m56s<br>nginx-dev3   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m50s<br></code></pre></div></td></tr></table></figure>

<ol start="39">
<li>获得带标签 env=dev 的 Pod 并输出标签<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> pods -l <span class="hljs-attribute">env</span>=dev --show-labels<br></code></pre></div></td></tr></table></figure></li>
<li>获得带有标签 env=pro 的 Pod</li>
</ol>
<p>kubectl get pods -l env=pro</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">NAME         READY   STATUS    RESTARTS   AGE<br>nginx-pro1   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">8</span>m25s<br>nginx-pro2   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">8</span>m19s<br></code></pre></div></td></tr></table></figure>

<ol start="41">
<li><p>获得带标签 env=prod 的 Pod 并输出标签</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> pods -l <span class="hljs-attribute">env</span>=pro --show-labels<br></code></pre></div></td></tr></table></figure></li>
<li><p>获取带有标签 env 的 Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> po -L env<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获得带标签 env=dev、env=pro 的 Pod</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> po -l <span class="hljs-string">'env in (dev,pro)'</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获取带有标签 env=dev 和 env=pro 的 Pod 并输出标签</p>
<figure class="highlight dart"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dart">kubectl <span class="hljs-keyword">get</span> po -l <span class="hljs-string">'env in (dev,pro)'</span> --<span class="hljs-keyword">show</span>-labels<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>将其中一个容器的标签更改为 env=uat 并列出所有要验证的容器</p>
<figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima">kubectl <span class="hljs-built_in">label</span> pod/nginx-pro1 env=aa --overwrite<br>kubectl <span class="hljs-built_in">get</span> pods --<span class="hljs-built_in">show</span>-<span class="hljs-built_in">labels</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>删除刚才创建的 Pod 标签，并确认所有标签均已删除</p>
<figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima">kubectl <span class="hljs-built_in">label</span> pod nginx-dev&#123;<span class="hljs-number">1</span>..<span class="hljs-number">3</span>&#125; env-<br>kubectl <span class="hljs-built_in">label</span> pod nginx-pro&#123;<span class="hljs-number">1</span>..<span class="hljs-number">2</span>&#125; env-<br>kubectl <span class="hljs-built_in">get</span> pods --<span class="hljs-built_in">show</span>-<span class="hljs-built_in">labels</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>为所有 Pod 添加标签 app = nginx 并验证</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl label pod nginx-dev&#123;1<span class="hljs-built_in">..</span>3&#125; <span class="hljs-attribute">app</span>=nginx<br>kubectl label pod nginx-pro&#123;1<span class="hljs-built_in">..</span>2&#125; <span class="hljs-attribute">app</span>=nginx<br>kubectl <span class="hljs-builtin-name">get</span> pods --show-labels<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获取所有带有标签的节点（如果使用 minikube，则只会获得主节点）</p>
</li>
</ol>
<p>kubectl get nodes –show-labels</p>
<figure class="highlight lua"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs lua">NAME         STATUS   ROLES    AGE   VERSION   LABELS<br>k8s-master   Ready    master   <span class="hljs-number">13</span>d   v1<span class="hljs-number">.16</span><span class="hljs-number">.3</span>   beta.kubernetes.<span class="hljs-built_in">io</span>/arch=amd64,beta.kubernetes.<span class="hljs-built_in">io</span>/<span class="hljs-built_in">os</span>=linux,kubernetes.<span class="hljs-built_in">io</span>/arch=amd64,kubernetes.<span class="hljs-built_in">io</span>/hostname=k8s-master,kubernetes.<span class="hljs-built_in">io</span>/<span class="hljs-built_in">os</span>=linux,node-role.kubernetes.<span class="hljs-built_in">io</span>/master=<br>k8s-node01   Ready    &lt;none&gt;   <span class="hljs-number">13</span>d   v1<span class="hljs-number">.16</span><span class="hljs-number">.3</span>   beta.kubernetes.<span class="hljs-built_in">io</span>/arch=amd64,beta.kubernetes.<span class="hljs-built_in">io</span>/<span class="hljs-built_in">os</span>=linux,kubernetes.<span class="hljs-built_in">io</span>/arch=amd64,kubernetes.<span class="hljs-built_in">io</span>/hostname=k8s-node01,kubernetes.<span class="hljs-built_in">io</span>/<span class="hljs-built_in">os</span>=linux<br>k8s-node02   Ready    &lt;none&gt;   <span class="hljs-number">13</span>d   v1<span class="hljs-number">.16</span><span class="hljs-number">.3</span>   beta.kubernetes.<span class="hljs-built_in">io</span>/arch=amd64,beta.kubernetes.<span class="hljs-built_in">io</span>/<span class="hljs-built_in">os</span>=linux,kubernetes.<span class="hljs-built_in">io</span>/arch=amd64,kubernetes.<span class="hljs-built_in">io</span>/hostname=k8s-node02,kubernetes.<span class="hljs-built_in">io</span>/<span class="hljs-built_in">os</span>=linux<br></code></pre></div></td></tr></table></figure>

<ol start="49">
<li>标记节点（如果正在使用，则为 minikube）nodeName = nginxnode<figure class="highlight crmsh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crmsh">kubectl label <span class="hljs-keyword">node</span> <span class="hljs-title">minikube</span> <span class="hljs-attr">nodeName=</span>nginxnode<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="50">
<li>建一个标签为 nginx=dev 的 Pod 并将其部署在此节点上<figure class="highlight crmsh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crmsh">kubectl label <span class="hljs-keyword">node</span> <span class="hljs-title">k8s-node01</span>  <span class="hljs-attr">nginx=</span>dev<br>kubectl label <span class="hljs-keyword">node</span> <span class="hljs-title">k8s-node02</span>  <span class="hljs-attr">nginx=</span>pro<br></code></pre></div></td></tr></table></figure>

</li>
</ol>
<p>参考文献<br>medium.com/bb-tutorials-and-thoughts/practice-enough-with-these-questions-for-the-ckad-exam</p>
<h1 id="Pod-设计、状态持久性"><a href="#Pod-设计、状态持久性" class="headerlink" title="Pod 设计、状态持久性"></a>Pod 设计、状态持久性</h1><ol start="52">
<li>使用节点选择器验证已调度的 Pod</li>
</ol>
<p>pod.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br>  <span class="hljs-attr">nodeSelector:</span> <br>  <span class="hljs-attr">nginx:</span> <span class="hljs-string">dev</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<p>在 50 基础上</p>
<p>kubectl describe po nginx | grep Node-Selectors</p>
<figure class="highlight crmsh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crmsh"><span class="hljs-keyword">Node</span>-Selectors:<span class="hljs-title">  nginx</span>=dev<br></code></pre></div></td></tr></table></figure>


<ol start="53">
<li><p>验证我们刚刚创建的 Pod Nginx 是否具有 nginx=dev 这个标签</p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl describe <span class="hljs-keyword">po</span> nginx | <span class="hljs-keyword">grep</span> Labels<br><br><br>Label<span class="hljs-variable">s:</span>       run=nginx<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>用 name=webapp 注释 Pod nginx-dev.<em>、nginx-pro.</em></p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl annotate po nginx-dev&#123;1<span class="hljs-built_in">..</span>3&#125; <span class="hljs-attribute">name</span>=webapp<br>kubectl annotate po nginx-pro&#123;1<span class="hljs-built_in">..</span>2&#125; <span class="hljs-attribute">name</span>=webapp<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="55">
<li>验证已正确注释的 Pod<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl describe <span class="hljs-keyword">po</span> nginx-dev&#123;<span class="hljs-number">1</span>..<span class="hljs-number">3</span>&#125; | <span class="hljs-keyword">grep</span> -i annotations<br>kubectl describe <span class="hljs-keyword">po</span> nginx-<span class="hljs-keyword">pro</span>&#123;<span class="hljs-number">1</span>..<span class="hljs-number">2</span>&#125; | <span class="hljs-keyword">grep</span> -i annotations<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="56">
<li><p>删除 Pod 上的注释并验证</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">kubectl annotate po nginx-dev&#123;<span class="hljs-number">1.</span><span class="hljs-number">.3</span>&#125; name-<br>kubectl annotate po nginx-pro&#123;<span class="hljs-number">1.</span><span class="hljs-number">.2</span>&#125; name-<br>kubectl describe po nginx-dev&#123;<span class="hljs-number">1.</span><span class="hljs-number">.3</span>&#125; | grep -i annotations<br>kubectl describe po nginx-pro&#123;<span class="hljs-number">1.</span><span class="hljs-number">.2</span>&#125; | grep -i annotations<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>删除到目前为止我们创建的所有 Pod</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">kubectl <span class="hljs-built_in">delete</span> pod <span class="hljs-comment">--all</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>创建一个名为 webapp 的 Deployment，它带有 5 个副本的镜像 Nginx</p>
</li>
</ol>
<p>kubectl create deployment  webapp –image=nginx –dry-run -o yaml &gt; webapp-deployment.yaml<br>更改 webapp-deployment 的 replicas 为 5</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">webapp</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">webapp</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">5</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">webapp</span><br>  <span class="hljs-attr">strategy:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">webapp</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>


<ol start="59">
<li>用标签获取我们刚刚创建的 Deployment</li>
</ol>
<p>kubectl get deploy webapp –show-labels</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">NAME     READY   UP-TO-DATE   AVAILABLE   AGE     LABELS<br>webapp   <span class="hljs-number">5</span>/<span class="hljs-number">5</span>     <span class="hljs-number">5</span>            <span class="hljs-number">5</span>           <span class="hljs-number">3</span>m59s   app=webapp<br></code></pre></div></td></tr></table></figure>

<ol start="60">
<li>导出该 Deployment 的 yaml 文件</li>
</ol>
<p>kubectl get deploy webapp -o yaml</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">apiVersion:</span> apps/v1<br><span class="hljs-symbol">kind:</span> Deployment<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  annotations:</span><br>    deployment.kubernetes.io/revision: <span class="hljs-string">"1"</span><br>    kubectl.kubernetes.io/last-applied-configuration: |<br>      &#123;<span class="hljs-string">"apiVersion"</span>:<span class="hljs-string">"apps/v1"</span>,<span class="hljs-string">"kind"</span>:<span class="hljs-string">"Deployment"</span>,<span class="hljs-string">"metadata"</span>:&#123;<span class="hljs-string">"annotations"</span>:&#123;&#125;,<span class="hljs-string">"creationTimestamp"</span>:null,<span class="hljs-string">"labels"</span>:&#123;<span class="hljs-string">"app"</span>:<span class="hljs-string">"webapp"</span>&#125;,<span class="hljs-string">"name"</span>:<span class="hljs-string">"webapp"</span>,<span class="hljs-string">"namespace"</span>:<span class="hljs-string">"default"</span>&#125;,<span class="hljs-string">"spec"</span>:&#123;<span class="hljs-string">"replicas"</span>:<span class="hljs-number">5</span>,<span class="hljs-string">"selector"</span>:&#123;<span class="hljs-string">"matchLabels"</span>:&#123;<span class="hljs-string">"app"</span>:<span class="hljs-string">"webapp"</span>&#125;&#125;,<span class="hljs-string">"strategy"</span>:&#123;&#125;,<span class="hljs-string">"template"</span>:&#123;<span class="hljs-string">"metadata"</span>:&#123;<span class="hljs-string">"creationTimestamp"</span>:null,<span class="hljs-string">"labels"</span>:&#123;<span class="hljs-string">"app"</span>:<span class="hljs-string">"webapp"</span>&#125;&#125;,<span class="hljs-string">"spec"</span>:&#123;<span class="hljs-string">"containers"</span>:[&#123;<span class="hljs-string">"image"</span>:<span class="hljs-string">"nginx"</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"nginx"</span>,<span class="hljs-string">"resources"</span>:&#123;&#125;&#125;]&#125;&#125;&#125;,<span class="hljs-string">"status"</span>:&#123;&#125;&#125;<br><span class="hljs-symbol">  creationTimestamp:</span> <span class="hljs-string">"2020-01-08T05:52:11Z"</span><br><span class="hljs-symbol">  generation:</span> <span class="hljs-number">1</span><br><span class="hljs-symbol">  labels:</span><br><span class="hljs-symbol">    app:</span> webapp<br><span class="hljs-symbol">  name:</span> webapp<br><span class="hljs-symbol">  namespace:</span> default<br><span class="hljs-symbol">  resourceVersion:</span> <span class="hljs-string">"30357"</span><br><span class="hljs-symbol">  selfLink:</span> <span class="hljs-meta-keyword">/apis/</span>apps<span class="hljs-meta-keyword">/v1/</span>namespaces<span class="hljs-meta-keyword">/default/</span>deployments/webapp<br><span class="hljs-symbol">  uid:</span> defb62c1<span class="hljs-number">-1</span>b1d<span class="hljs-number">-43</span>db-ab43<span class="hljs-number">-5</span>cfe90f67d68<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol">  progressDeadlineSeconds:</span> <span class="hljs-number">600</span><br><span class="hljs-symbol">  replicas:</span> <span class="hljs-number">5</span><br><span class="hljs-symbol">  revisionHistoryLimit:</span> <span class="hljs-number">10</span><br><span class="hljs-symbol">  selector:</span><br><span class="hljs-symbol">    matchLabels:</span><br><span class="hljs-symbol">      app:</span> webapp<br><span class="hljs-symbol">  strategy:</span><br><span class="hljs-symbol">    rollingUpdate:</span><br><span class="hljs-symbol">      maxSurge:</span> <span class="hljs-number">25</span>%<br><span class="hljs-symbol">      maxUnavailable:</span> <span class="hljs-number">25</span>%<br><span class="hljs-symbol">    type:</span> RollingUpdate<br><span class="hljs-symbol">  template:</span><br><span class="hljs-symbol">    metadata:</span><br><span class="hljs-symbol">      creationTimestamp:</span> null<br><span class="hljs-symbol">      labels:</span><br><span class="hljs-symbol">        app:</span> webapp<br><span class="hljs-symbol">    spec:</span><br><span class="hljs-symbol">      containers:</span><br>      - image: nginx<br><span class="hljs-symbol">        imagePullPolicy:</span> Always<br><span class="hljs-symbol">        name:</span> nginx<br><span class="hljs-symbol">        resources:</span> &#123;&#125;<br><span class="hljs-symbol">        terminationMessagePath:</span> <span class="hljs-meta-keyword">/dev/</span>termination-log<br><span class="hljs-symbol">        terminationMessagePolicy:</span> File<br><span class="hljs-symbol">      dnsPolicy:</span> ClusterFirst<br><span class="hljs-symbol">      restartPolicy:</span> Always<br><span class="hljs-symbol">      schedulerName:</span> default-scheduler<br><span class="hljs-symbol">      securityContext:</span> &#123;&#125;<br><span class="hljs-symbol">      terminationGracePeriodSeconds:</span> <span class="hljs-number">30</span><br><span class="hljs-symbol">status:</span><br><span class="hljs-symbol">  availableReplicas:</span> <span class="hljs-number">5</span><br><span class="hljs-symbol">  conditions:</span><br>  - lastTransitionTime: <span class="hljs-string">"2020-01-08T05:52:26Z"</span><br><span class="hljs-symbol">    lastUpdateTime:</span> <span class="hljs-string">"2020-01-08T05:52:26Z"</span><br><span class="hljs-symbol">    message:</span> Deployment has minimum availability.<br><span class="hljs-symbol">    reason:</span> MinimumReplicasAvailable<br><span class="hljs-symbol">    status:</span> <span class="hljs-string">"True"</span><br><span class="hljs-symbol">    type:</span> Available<br>  - lastTransitionTime: <span class="hljs-string">"2020-01-08T05:52:11Z"</span><br><span class="hljs-symbol">    lastUpdateTime:</span> <span class="hljs-string">"2020-01-08T05:52:29Z"</span><br><span class="hljs-symbol">    message:</span> ReplicaSet <span class="hljs-string">"webapp-58867d7bbb"</span> has successfully progressed.<br><span class="hljs-symbol">    reason:</span> NewReplicaSetAvailable<br><span class="hljs-symbol">    status:</span> <span class="hljs-string">"True"</span><br><span class="hljs-symbol">    type:</span> Progressing<br><span class="hljs-symbol">  observedGeneration:</span> <span class="hljs-number">1</span><br><span class="hljs-symbol">  readyReplicas:</span> <span class="hljs-number">5</span><br><span class="hljs-symbol">  replicas:</span> <span class="hljs-number">5</span><br><span class="hljs-symbol">  updatedReplicas:</span> <span class="hljs-number">5</span><br></code></pre></div></td></tr></table></figure>

<ol start="61">
<li>获取该 Deployment 的 Pod</li>
</ol>
<p>kubectl get deploy –show-labels</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">NAME               READY   UP-TO-DATE   AVAILABLE   AGE    LABELS<br>nginx-deployment   <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     <span class="hljs-number">3</span>            <span class="hljs-number">3</span>           <span class="hljs-number">19</span>h    app=nginx<br>webapp             <span class="hljs-number">5</span>/<span class="hljs-number">5</span>     <span class="hljs-number">5</span>            <span class="hljs-number">5</span>           <span class="hljs-number">7</span>m1s   app=webapp<br></code></pre></div></td></tr></table></figure>
<p>kubectl get po -l app=webapp</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">NAME                      READY   STATUS    RESTARTS   AGE<br>webapp<span class="hljs-number">-58867</span>d7bbb<span class="hljs-number">-4</span>q5nn   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m29s<br>webapp<span class="hljs-number">-58867</span>d7bbb<span class="hljs-number">-9</span>jxc7   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m29s<br>webapp<span class="hljs-number">-58867</span>d7bbb-hxfv6   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m29s<br>webapp<span class="hljs-number">-58867</span>d7bbb-qj2nk   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m29s<br>webapp<span class="hljs-number">-58867</span>d7bbb-wmms4   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m29s<br></code></pre></div></td></tr></table></figure>

<ol start="62">
<li><p>将该 Deployment 从 5 个副本扩展到 20 个副本并验证</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl scale deploy webapp <span class="hljs-attribute">--replicas</span>=20<br><br>尝试 <span class="hljs-attribute">--replicas</span>=1000 机器配置过低 会发生问题<br><br>kubectl <span class="hljs-builtin-name">get</span> po -l <span class="hljs-attribute">app</span>=webapp<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获取该 Deployment 的 rollout 状态</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">kubectl rollout status deploy webapp</span><br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="64">
<li><p>获取使用该 Deployment 创建的副本集</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> rs -l <span class="hljs-attribute">app</span>=webapp<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获取该 Deployment 的副本集和 Pod 的 yaml</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> rs -l <span class="hljs-attribute">app</span>=webapp -o yaml<br>kubectl <span class="hljs-builtin-name">get</span> po -l <span class="hljs-attribute">app</span>=webapp -o yaml<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>删除刚创建的 Deployment，并查看所有 Pod 是否已被删除</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl delete deploy webapp<br>kubectl <span class="hljs-builtin-name">get</span> po -l <span class="hljs-attribute">app</span>=webapp -w<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>使用镜像 nginx：1.17.1 和容器端口 80 创建 webapp Deployment，并验证镜像版本</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl create deploy webapp <span class="hljs-attribute">--image</span>=nginx:1.17.1 --dry-<span class="hljs-builtin-name">run</span> -o yaml &gt; webapp.yaml<br></code></pre></div></td></tr></table></figure>
<p>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>creationTimestamp: null<br>labels:<br>app: webapp<br>name: webapp<br>spec:<br>replicas: 1<br>selector:<br>matchLabels:<br>  app: webapp<br>strategy: {}<br>template:<br>metadata:<br>  creationTimestamp: null<br>  labels:</p>
<div class="hljs code-wrapper"><pre><code>app: webapp</code></pre></div><p>spec:<br>  containers:</p>
<ul>
<li>image: nginx:1.17.1<br>name: nginx<br>ports: <ul>
<li>containerPort: 80<br>resources: {}<br>status: {}<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><br>68. 使用镜像版本 1.17.4 更新 Deployment 并验证<br><br>kubectl <span class="hljs-builtin-name">set</span> image deploy/webapp <span class="hljs-attribute">nginx</span>=nginx:1.17.4<br>kubectl <span class="hljs-builtin-name">get</span> deploy  -o wide<br></code></pre></div></td></tr></table></figure>
NAME               READY   UP-TO-DATE   AVAILABLE   AGE    CONTAINERS   IMAGES         SELECTOR<br>nginx-deployment   3/3     3            3           20h    nginx        nginx:1.7.9    app=nginx<br>webapp             1/1     1            1           5m7s   nginx        nginx:1.17.4   app=webapp<figure class="highlight 1c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs 1c"><br>kubectl describe deploy webapp <span class="hljs-string">| grep Image</span><br></code></pre></div></td></tr></table></figure>
Image:        nginx:1.17.4<figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli"><br>69. 检查 rollout 历史记录，并确保更新后一切正常<br><br>kubectl rollout <span class="hljs-keyword">history</span> <span class="hljs-keyword">deploy</span> webapp<br></code></pre></div></td></tr></table></figure>
deployment.apps/webapp<br>REVISION  CHANGE-CAUSE<br>1         <none><br>2         <none><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> deploy webapp --show-labels<br>kubectl <span class="hljs-builtin-name">get</span> rs -l <span class="hljs-attribute">app</span>=webapp<br>kubectl <span class="hljs-builtin-name">get</span> po -l <span class="hljs-attribute">app</span>=webapp<br><br>70. 撤消之前使用版本 1.17.1 的 Deployment，并验证镜像是否还有老版本<br><br>kubectl rollout undo deploy webapp<br>kubectl rollout history deploy webapp<br></code></pre></div></td></tr></table></figure>
deployment.apps/webapp<br>REVISION  CHANGE-CAUSE<br>2         <none><br>3         <none><figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">kubectl describe deploy webapp | grep Image<br><br><span class="hljs-number">71.</span> 使用镜像版本 <span class="hljs-number">1.16</span><span class="hljs-number">.1</span> 更新 Deployment，并验证镜像、检查 rollout 历史记录<br><br>kubectl <span class="hljs-keyword">set</span> image deploy/webapp nginx=nginx:<span class="hljs-number">1.16</span><span class="hljs-number">.1</span><br>kubectl rollout status deploy webapp<br></code></pre></div></td></tr></table></figure>
Waiting for deployment “webapp” rollout to finish: 1 old replicas are pending termination…<br>Waiting for deployment “webapp” rollout to finish: 1 old replicas are pending termination…<br>deployment “webapp” successfully rolled out<figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">kubectl rollout <span class="hljs-keyword">history</span> <span class="hljs-keyword">deploy</span> webapp<br></code></pre></div></td></tr></table></figure>
deployment.apps/webapp<br>REVISION  CHANGE-CAUSE<br>2         <none><br>3         <none><br>4         <none></li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">kubectl describe deploy webapp | grep Image<br>  Image:        nginx:<span class="hljs-number">1.16</span><span class="hljs-number">.1</span><br></code></pre></div></td></tr></table></figure>

<ol start="72">
<li>将 Deployment 更新到镜像 1.17.1 并确认一切正常<figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">kubectl rollout undo <span class="hljs-keyword">deploy</span> webapp <span class="hljs-params">--to-revision=3</span><br>kubectl rollout <span class="hljs-keyword">history</span> <span class="hljs-keyword">deploy</span> webapp<br>kubectl describe <span class="hljs-keyword">deploy</span> webapp | grep Image<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="73">
<li><p>使用错误的镜像版本 1.100 更新 Deployment，并验证有问题</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">set</span> image deploy/webapp <span class="hljs-attribute">nginx</span>=nginx:1.10000<br>kubectl rollout history deploy webapp<br>kubectl <span class="hljs-builtin-name">get</span> pods<br>kubectl describe po pod名称<br><span class="hljs-builtin-name">Warning</span>  Failed     2s (x2 over 52s)   kubelet, k8s-node01  Error: ImagePullBackOff<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>撤消使用先前版本的 Deployment，并确认一切正常</p>
<figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">kubectl</span> <span class="hljs-string">rollout undo deploy webapp</span><br><span class="hljs-attr">kubectl</span> <span class="hljs-string">rollout status deploy webapp</span><br><span class="hljs-attr">kubectl</span> <span class="hljs-string">get pods</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>检查该 Deployment 的特定修订版本的历史记录</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">kubectl rollout <span class="hljs-keyword">history</span> <span class="hljs-keyword">deploy</span> webapp <span class="hljs-params">--revision=</span>特定版本记录号<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="76">
<li><p>暂停 Deployment rollout</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs autohotkey">kubectl rollout <span class="hljs-keyword">pause</span> deploy  webapp<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>用最新版本的镜像更新 Deployment，并检查历史记录</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">kubectl <span class="hljs-keyword">set</span> image <span class="hljs-keyword">deploy</span>/webapp nginx=nginx<span class="hljs-function">:lastest</span><br>kubectl rollout <span class="hljs-keyword">history</span> <span class="hljs-keyword">deploy</span> webapp<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>恢复 Deployment rollout</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">kubectl rollout resume deploy  webapp</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>检查 rollout 历史记录，确保是最新版本</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">kubectl rollout <span class="hljs-keyword">history</span> <span class="hljs-keyword">deploy</span> webapp<br>kubectl rollout <span class="hljs-keyword">history</span> <span class="hljs-keyword">deploy</span> webapp <span class="hljs-params">--revision=9</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>将自动伸缩应用到该 Deployment 中，最少副本数为 10，最大副本数为 20，<br>目标 CPU 利用率 85%，并验证 hpa 已创建，将副本数从 1 个增加到 10 个</p>
</li>
</ol>
<p>kubectl autoscale deploy webapp –min=10 –max=20 –cpu-percent=85</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">kubectl <span class="hljs-keyword">get</span> hpa<br>NAME     REFERENCE           TARGETS         MINPODS   MAXPODS   REPLICAS   AGE<br>webapp   Deployment/webapp   &lt;unknown&gt;/<span class="hljs-number">85</span>%   <span class="hljs-number">10</span>        <span class="hljs-number">20</span>        <span class="hljs-number">0</span>          <span class="hljs-number">9</span>s<br></code></pre></div></td></tr></table></figure>
<p>kubectl get po -l app=webapp</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">NAME                      READY   STATUS    RESTARTS   AGE<br>webapp<span class="hljs-number">-7668577</span>c8f<span class="hljs-number">-98</span>ltc   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-bjmhz   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-cbl2k   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-dnb5z   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m54s<br>webapp<span class="hljs-number">-7668577</span>c8f-dvfrt   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-gcqgt   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-ht8pg   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-nhjzs   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-nsmqd   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br>webapp<span class="hljs-number">-7668577</span>c8f-rjg58   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">29</span>s<br></code></pre></div></td></tr></table></figure>

<ol start="81">
<li><p>通过删除刚刚创建的 Deployment 和 hpa 来清理集群</p>
<figure class="highlight actionscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs actionscript">kubectl <span class="hljs-keyword">delete</span> deploy webapp<br>kubectl <span class="hljs-keyword">delete</span> hpa webapp<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>用镜像 node 创建一个 Job，并验证是否有对应的 Pod 创建</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl create job nodeversion <span class="hljs-attribute">--image</span>=node -- node v<br>kubectl <span class="hljs-builtin-name">get</span> job -w<br>kubectl <span class="hljs-builtin-name">get</span> pod<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>获取刚刚创建的 Job 的日志</p>
<figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">kubectl</span> logs pod 名称<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>用镜像 busybox 输出 Job 的 yaml 文件，并回显“Hello I am from job”</p>
</li>
</ol>
<p>kubectl create job hello-job –image=busybox –dry-run -o yaml – echo “Hello I am from job”</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">hello-job</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Hello</span> <span class="hljs-string">I</span> <span class="hljs-string">am</span> <span class="hljs-string">from</span> <span class="hljs-string">job</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">hello-job</span><br>        <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<ol start="85">
<li><p>将上面的 yaml 文件复制到 hello-job.yaml 文件并创建 Job</p>
<figure class="highlight cos"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cos">kubectl create <span class="hljs-keyword">job</span> hello-<span class="hljs-keyword">job</span> --image=busybox --dry-run -o yaml -- echo <span class="hljs-string">"Hello I am from job"</span> &gt; hello-<span class="hljs-keyword">job</span>.yaml<br><br>kubectl apply -f hello-<span class="hljs-keyword">job</span>.yaml<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>验证 Job 并创建关联的容器，检查日志</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">kubectl <span class="hljs-builtin-name">get</span> pod<br>kubectl <span class="hljs-builtin-name">get</span> po<br>kubectl logs po 名称<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>删除我们刚刚创建的 Job</p>
<figure class="highlight cos"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cos">kubectl delete <span class="hljs-keyword">job</span> hello-<span class="hljs-keyword">job</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>创建一个相同的 Job，并使它一个接一个地运行 10 次</p>
</li>
</ol>
<p>kubectl create job hello-job –image=busybox –dry-run -o yaml – echo “Hello I am from job” &gt; 10-job.yaml</p>
<p>在 10-job.yaml 添加 completions: 10</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">hello-job</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">completions:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Hello</span> <span class="hljs-string">I</span> <span class="hljs-string">am</span> <span class="hljs-string">from</span> <span class="hljs-string">Job</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">hello-job</span><br>        <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>
<p>kubectl get job -w<br>kubectl get po</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">NAME          COMPLETIONS   DURATION   AGE<br>hello-job     <span class="hljs-number">9</span>/<span class="hljs-number">10</span>          <span class="hljs-number">53</span>s        <span class="hljs-number">53</span>s<br>nodeversion   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>           <span class="hljs-number">3</span>m14s      <span class="hljs-number">18</span>m<br>hello-job     <span class="hljs-number">10</span>/<span class="hljs-number">10</span>         <span class="hljs-number">59</span>s        <span class="hljs-number">59</span>s<br></code></pre></div></td></tr></table></figure>


<ol start="89">
<li><p>运行 10 次，确认已创建 10 个 Pod，并在完成后删除它们</p>
<figure class="highlight cos"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cos">kubectl delete <span class="hljs-keyword">job</span> hello-<span class="hljs-keyword">job</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>创建相同的 Job 并使它并行运行 10 次</p>
</li>
</ol>
<p>kubectl create job hello-job –image=busybox –dry-run -o yaml – echo “Hello I am from job” &gt; 10-parallelism-job.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">hello-job</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">parallelism:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Hello</span> <span class="hljs-string">I</span> <span class="hljs-string">am</span> <span class="hljs-string">from</span> <span class="hljs-string">Job</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">hello-job</span><br>        <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br><span class="hljs-attr">status:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<ol start="91">
<li>并行运行 10 次，确认已创建 10 个 Pod，并在完成后将其删除</li>
</ol>
<p>kubectl get job -w<br>kubectl get po</p>
<ol start="92">
<li>创建一个带有 busybox 镜像的 Cronjob，每分钟打印一次来自 Kubernetes 集群消息的日期和 hello</li>
</ol>
<p>kubectl create cronjob date-job –image=busybox –schedule=”*/1 * * * *” – bin/sh -c “date; echo Hello from kubernetes cluster”</p>
<p>kubectl get cronjob</p>
<p>kubectl get po</p>
<p>kubectl logs pod 名称</p>
<ol start="93">
<li>输出上述 cronjob 的 yaml 文件</li>
</ol>
<p>kubectl get cj date-job -o yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CronJob</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-string">"2020-01-08T08:50:52Z"</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">date-job</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">resourceVersion:</span> <span class="hljs-string">"50543"</span><br>  <span class="hljs-attr">selfLink:</span> <span class="hljs-string">/apis/batch/v1beta1/namespaces/default/cronjobs/date-job</span><br>  <span class="hljs-attr">uid:</span> <span class="hljs-string">22d49b8d-58ec-468a-b589-d5f60f0030c0</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">concurrencyPolicy:</span> <span class="hljs-string">Allow</span><br>  <span class="hljs-attr">failedJobsHistoryLimit:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">jobTemplate:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">date-job</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">metadata:</span><br>          <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>        <span class="hljs-attr">spec:</span><br>          <span class="hljs-attr">containers:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">bin/sh</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">-c</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">date;</span> <span class="hljs-string">echo</span> <span class="hljs-string">Hello</span> <span class="hljs-string">from</span> <span class="hljs-string">kubernetes</span> <span class="hljs-string">cluster</span><br>            <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>            <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">Always</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">date-job</span><br>            <span class="hljs-attr">resources:</span> <span class="hljs-string">&#123;&#125;</span><br>            <span class="hljs-attr">terminationMessagePath:</span> <span class="hljs-string">/dev/termination-log</span><br>            <span class="hljs-attr">terminationMessagePolicy:</span> <span class="hljs-string">File</span><br>          <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>          <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span><br>          <span class="hljs-attr">schedulerName:</span> <span class="hljs-string">default-scheduler</span><br>          <span class="hljs-attr">securityContext:</span> <span class="hljs-string">&#123;&#125;</span><br>          <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">30</span><br>  <span class="hljs-attr">schedule:</span> <span class="hljs-string">'*/1 * * * *'</span><br>  <span class="hljs-attr">successfulJobsHistoryLimit:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">suspend:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">lastScheduleTime:</span> <span class="hljs-string">"2020-01-08T08:51:00Z"</span><br></code></pre></div></td></tr></table></figure>

<ol start="94">
<li><p>验证 cronJob 为每分钟运行创建一个单独的 Job 和 Pod，并验证 Pod 的日志</p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl <span class="hljs-built_in">get</span> job<br>kubectl <span class="hljs-built_in">get</span> <span class="hljs-keyword">po</span><br>kubectl logs date-job-<span class="hljs-symbol">&lt;jobid&gt;</span>-<span class="hljs-symbol">&lt;pod&gt;</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>删除 cronJob，并验证所有关联的 Job 和 Pod 也都被删除</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">kubectl <span class="hljs-built_in">delete</span> cj <span class="hljs-built_in">date</span>-job<br>// verify pods <span class="hljs-keyword">and</span> jobs<br>kubectl <span class="hljs-built_in">get</span> po<br>kubectl <span class="hljs-built_in">get</span> job<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>列出集群中的持久卷</p>
<figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima">kubectl <span class="hljs-built_in">get</span> <span class="hljs-built_in">pv</span><br></code></pre></div></td></tr></table></figure>
</li>
<li><p>创建一个名为 task-pv-volume 的 PersistentVolume，其 storgeClassName 为 manual，storage 为 10Gi，accessModes 为 ReadWriteOnce，hostPath 为 /mnt/data</p>
</li>
</ol>
<p>task-pv-volume.yaml</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">apiVersion:</span> v1<br><span class="hljs-symbol">kind:</span> PersistentVolume<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  name:</span> task-pv-volume<br><span class="hljs-symbol">  labels:</span> <br><span class="hljs-symbol">    type:</span> local<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol">  capacity:</span><br><span class="hljs-symbol">    storage:</span> <span class="hljs-number">10</span>Gi<br><span class="hljs-symbol">  accessModes:</span><br>    - ReadWriteOnce<br><span class="hljs-symbol">  storageClassName:</span> manual<br><span class="hljs-symbol">  hostPath:</span> <br><span class="hljs-symbol">    path:</span> <span class="hljs-string">"/mnt/data"</span><br></code></pre></div></td></tr></table></figure>
<p>kubectl get pv</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">NAME             CAPACITY   ACCESS MODES   RECLAIM<span class="hljs-built_in"> POLICY </span>  STATUS      CLAIM   STORAGECLASS   REASON   AGE<br>task-pv-volume   10Gi       RWO            Retain           Available          <span class="hljs-built_in"> manual </span>                 88s<br></code></pre></div></td></tr></table></figure>



<ol start="98">
<li>创建一个存储至少 3Gi、访问模式为 ReadWriteOnce 的 PersistentVolumeClaim，并确认它的状态是否是绑定的</li>
</ol>
<p>kubectl create -f task-pv-claim.yaml<br>kubectl get pvc</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">apiVersion:</span> v1<br><span class="hljs-symbol">kind:</span> PersistentVolumeClaim<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  name:</span> task-pv-claim<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol">  accessModes:</span><br>    - ReadWriteOnce<br><span class="hljs-symbol">  resources:</span><br><span class="hljs-symbol">    requests:</span><br><span class="hljs-symbol">      storage:</span> <span class="hljs-number">3</span>Gi<br><span class="hljs-symbol">  storageClassName:</span> manual<br></code></pre></div></td></tr></table></figure>

<ol start="99">
<li><p>删除我们刚刚创建的持久卷和 PersistentVolumeClaim</p>
<figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima">kubectl <span class="hljs-built_in">delete</span> pvc task-<span class="hljs-built_in">pv</span>-claim<br>kubectl <span class="hljs-built_in">delete</span> <span class="hljs-built_in">pv</span> task-<span class="hljs-built_in">pv</span>-volume<br></code></pre></div></td></tr></table></figure>
</li>
<li><p>使用镜像 Redis 创建 Pod，并配置一个在 Pod 生命周期内可持续使用的卷</p>
</li>
</ol>
<p>redis-storage.yaml</p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-attribute">apiVersion</span>: v1<br><span class="hljs-attribute">kind</span>: Pod<br><span class="hljs-attribute">metadata</span>:<br>  <span class="hljs-attribute">name</span>: redis<br><span class="hljs-attribute">spec</span>:<br>  <span class="hljs-attribute">containers</span>:<br>  - <span class="hljs-attribute">name</span>: redis<br>    <span class="hljs-attribute">image</span>: redis<br>    <span class="hljs-attribute">volumeMounts</span>:<br>    - <span class="hljs-attribute">name</span>: redis-storage<br>      <span class="hljs-attribute">mountPath</span>: /data/redis<br>  <span class="hljs-attribute">volumes</span>:<br>  - <span class="hljs-attribute">name</span>: redis-storage<br>    <span class="hljs-attribute">emptyDir</span>: &#123;&#125;<br></code></pre></div></td></tr></table></figure>

<ol start="101">
<li>在上面的 Pod 中执行操作，并在 /data/redis 路径中创建一个名为 file.txt 的文件，其文本为“This is the file”，然后打开另一个选项卡，再次使用同一 Pod 执行，并验证文件是否在同一路径中<figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">kubectl exec -it redis <span class="hljs-string">/bin/sh</span><br><br><span class="hljs-keyword">cd</span> <span class="hljs-string">/data/redis</span><br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">"This is the file"</span> &gt; file.txt<br></code></pre></div></td></tr></table></figure>


</li>
</ol>
<ol start="102">
<li>删除上面的 Pod，然后从相同的 yaml 文件再次创建，并验证路径 /data/redis 中是否没有 file.txt<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">kubectl <span class="hljs-keyword">delete</span> <span class="hljs-keyword">po</span> redis<br><br>kubectl apply -<span class="hljs-keyword">f</span> redis-storage.yaml<br><br>kubectl exec -it redis /bin/<span class="hljs-keyword">sh</span><br><br><span class="hljs-keyword">cat</span> /data/redis/<span class="hljs-keyword">file</span>.txt<br><span class="hljs-keyword">ca</span><span class="hljs-variable">t:</span> /data/redis/<span class="hljs-keyword">file</span>.tx<span class="hljs-variable">t:</span> No such <span class="hljs-keyword">file</span> <span class="hljs-built_in">or</span> directory<br></code></pre></div></td></tr></table></figure>



</li>
</ol>
<ol start="103">
<li>创建一个名为 task-pv-volume 的 PersistentVolume，其 storgeClassName 为 manual，storage 为 10Gi，accessModes 为 ReadWriteOnce，hostPath 为 /mnt/data；并创建一个存储至少 3Gi、访问模式为 ReadWriteOnce 的 PersistentVolumeClaim，并确认它的状态是否是绑定的</li>
</ol>
<p>kubectl create -f task-pv-volume.yaml<br>kubectl create -f task-pv-claim.yaml<br>kubectl get pv<br>kubectl get pvc</p>
<p>配置如下所述：<br>task-pv-volume.yaml</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">apiVersion:</span> v1<br><span class="hljs-symbol">kind:</span> PersistentVolume<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  name:</span> task-pv-volume<br><span class="hljs-symbol">  labels:</span> <br><span class="hljs-symbol">    type:</span> local<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol">  capacity:</span><br><span class="hljs-symbol">    storage:</span> <span class="hljs-number">10</span>Gi<br><span class="hljs-symbol">  accessModes:</span><br>    - ReadWriteOnce<br><span class="hljs-symbol">  storageClassName:</span> manual<br><span class="hljs-symbol">  hostPath:</span> <br><span class="hljs-symbol">    path:</span> <span class="hljs-string">"/mnt/data"</span><br></code></pre></div></td></tr></table></figure>
<p>task-pv-claim.yaml</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">apiVersion:</span> v1<br><span class="hljs-symbol">kind:</span> PersistentVolumeClaim<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  name:</span> task-pv-claim<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol">  accessModes:</span><br>    - ReadWriteOnce<br><span class="hljs-symbol">  resources:</span><br><span class="hljs-symbol">    requests:</span><br><span class="hljs-symbol">      storage:</span> <span class="hljs-number">3</span>Gi<br><span class="hljs-symbol">  storageClassName:</span> manual<br></code></pre></div></td></tr></table></figure>


<ol start="104">
<li>用容器端口 80 和 PersistentVolumeClaim task-pv-claim 创建一个 Nginx 容器，且具有路径“/usr/share/nginx/html”</li>
</ol>
<p>task-pv-pod.yaml</p>
<p>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: task-pv-pod<br>spec:<br>  containers:<br>    - name: task-pv-container<br>      image: nginx<br>      ports:<br>        - containerPort: 80<br>          name: “http-server”<br>      volumeMounts:<br>      - mountPath: “/usr/share/nginx/html”<br>        name: task-pv-storage<br>  volumes:<br>    - name: task-pv-storage<br>      persistentVolumeClaim:<br>        claimName: task-pv-claim</p>
<p>kubectl get pv<br>NAME             CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                   STORAGECLASS   REASON   AGE<br>task-pv-volume   10Gi       RWO            Retain           Bound    default/task-pv-claim   manual                  85m</p>
<p>kubectl get pvc<br>NAME            STATUS   VOLUME           CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br>task-pv-claim   Bound    task-pv-volume   10Gi       RWO            manual         10m</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/05/29/drone%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">drone使用手册</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/05/23/MTU%E6%98%AF%E4%BB%80%E4%B9%88/">
                        <span class="hidden-mobile">MTU是什么</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
